from __future__ import absolute_import, division, unicode_literals

import re
import warnings

from .constants import DataLossWarning

baseChar = ***REMOVED***
[#x0041-#x005A***REMOVED*** | [#x0061-#x007A***REMOVED*** | [#x00C0-#x00D6***REMOVED*** | [#x00D8-#x00F6***REMOVED*** |
[#x00F8-#x00FF***REMOVED*** | [#x0100-#x0131***REMOVED*** | [#x0134-#x013E***REMOVED*** | [#x0141-#x0148***REMOVED*** |
[#x014A-#x017E***REMOVED*** | [#x0180-#x01C3***REMOVED*** | [#x01CD-#x01F0***REMOVED*** | [#x01F4-#x01F5***REMOVED*** |
[#x01FA-#x0217***REMOVED*** | [#x0250-#x02A8***REMOVED*** | [#x02BB-#x02C1***REMOVED*** | #x0386 |
[#x0388-#x038A***REMOVED*** | #x038C | [#x038E-#x03A1***REMOVED*** | [#x03A3-#x03CE***REMOVED*** |
[#x03D0-#x03D6***REMOVED*** | #x03DA | #x03DC | #x03DE | #x03E0 | [#x03E2-#x03F3***REMOVED*** |
[#x0401-#x040C***REMOVED*** | [#x040E-#x044F***REMOVED*** | [#x0451-#x045C***REMOVED*** | [#x045E-#x0481***REMOVED*** |
[#x0490-#x04C4***REMOVED*** | [#x04C7-#x04C8***REMOVED*** | [#x04CB-#x04CC***REMOVED*** | [#x04D0-#x04EB***REMOVED*** |
[#x04EE-#x04F5***REMOVED*** | [#x04F8-#x04F9***REMOVED*** | [#x0531-#x0556***REMOVED*** | #x0559 |
[#x0561-#x0586***REMOVED*** | [#x05D0-#x05EA***REMOVED*** | [#x05F0-#x05F2***REMOVED*** | [#x0621-#x063A***REMOVED*** |
[#x0641-#x064A***REMOVED*** | [#x0671-#x06B7***REMOVED*** | [#x06BA-#x06BE***REMOVED*** | [#x06C0-#x06CE***REMOVED*** |
[#x06D0-#x06D3***REMOVED*** | #x06D5 | [#x06E5-#x06E6***REMOVED*** | [#x0905-#x0939***REMOVED*** | #x093D |
[#x0958-#x0961***REMOVED*** | [#x0985-#x098C***REMOVED*** | [#x098F-#x0990***REMOVED*** | [#x0993-#x09A8***REMOVED*** |
[#x09AA-#x09B0***REMOVED*** | #x09B2 | [#x09B6-#x09B9***REMOVED*** | [#x09DC-#x09DD***REMOVED*** |
[#x09DF-#x09E1***REMOVED*** | [#x09F0-#x09F1***REMOVED*** | [#x0A05-#x0A0A***REMOVED*** | [#x0A0F-#x0A10***REMOVED*** |
[#x0A13-#x0A28***REMOVED*** | [#x0A2A-#x0A30***REMOVED*** | [#x0A32-#x0A33***REMOVED*** | [#x0A35-#x0A36***REMOVED*** |
[#x0A38-#x0A39***REMOVED*** | [#x0A59-#x0A5C***REMOVED*** | #x0A5E | [#x0A72-#x0A74***REMOVED*** |
[#x0A85-#x0A8B***REMOVED*** | #x0A8D | [#x0A8F-#x0A91***REMOVED*** | [#x0A93-#x0AA8***REMOVED*** |
[#x0AAA-#x0AB0***REMOVED*** | [#x0AB2-#x0AB3***REMOVED*** | [#x0AB5-#x0AB9***REMOVED*** | #x0ABD | #x0AE0 |
[#x0B05-#x0B0C***REMOVED*** | [#x0B0F-#x0B10***REMOVED*** | [#x0B13-#x0B28***REMOVED*** | [#x0B2A-#x0B30***REMOVED*** |
[#x0B32-#x0B33***REMOVED*** | [#x0B36-#x0B39***REMOVED*** | #x0B3D | [#x0B5C-#x0B5D***REMOVED*** |
[#x0B5F-#x0B61***REMOVED*** | [#x0B85-#x0B8A***REMOVED*** | [#x0B8E-#x0B90***REMOVED*** | [#x0B92-#x0B95***REMOVED*** |
[#x0B99-#x0B9A***REMOVED*** | #x0B9C | [#x0B9E-#x0B9F***REMOVED*** | [#x0BA3-#x0BA4***REMOVED*** |
[#x0BA8-#x0BAA***REMOVED*** | [#x0BAE-#x0BB5***REMOVED*** | [#x0BB7-#x0BB9***REMOVED*** | [#x0C05-#x0C0C***REMOVED*** |
[#x0C0E-#x0C10***REMOVED*** | [#x0C12-#x0C28***REMOVED*** | [#x0C2A-#x0C33***REMOVED*** | [#x0C35-#x0C39***REMOVED*** |
[#x0C60-#x0C61***REMOVED*** | [#x0C85-#x0C8C***REMOVED*** | [#x0C8E-#x0C90***REMOVED*** | [#x0C92-#x0CA8***REMOVED*** |
[#x0CAA-#x0CB3***REMOVED*** | [#x0CB5-#x0CB9***REMOVED*** | #x0CDE | [#x0CE0-#x0CE1***REMOVED*** |
[#x0D05-#x0D0C***REMOVED*** | [#x0D0E-#x0D10***REMOVED*** | [#x0D12-#x0D28***REMOVED*** | [#x0D2A-#x0D39***REMOVED*** |
[#x0D60-#x0D61***REMOVED*** | [#x0E01-#x0E2E***REMOVED*** | #x0E30 | [#x0E32-#x0E33***REMOVED*** |
[#x0E40-#x0E45***REMOVED*** | [#x0E81-#x0E82***REMOVED*** | #x0E84 | [#x0E87-#x0E88***REMOVED*** | #x0E8A |
#x0E8D | [#x0E94-#x0E97***REMOVED*** | [#x0E99-#x0E9F***REMOVED*** | [#x0EA1-#x0EA3***REMOVED*** | #x0EA5 |
#x0EA7 | [#x0EAA-#x0EAB***REMOVED*** | [#x0EAD-#x0EAE***REMOVED*** | #x0EB0 | [#x0EB2-#x0EB3***REMOVED*** |
#x0EBD | [#x0EC0-#x0EC4***REMOVED*** | [#x0F40-#x0F47***REMOVED*** | [#x0F49-#x0F69***REMOVED*** |
[#x10A0-#x10C5***REMOVED*** | [#x10D0-#x10F6***REMOVED*** | #x1100 | [#x1102-#x1103***REMOVED*** |
[#x1105-#x1107***REMOVED*** | #x1109 | [#x110B-#x110C***REMOVED*** | [#x110E-#x1112***REMOVED*** | #x113C |
#x113E | #x1140 | #x114C | #x114E | #x1150 | [#x1154-#x1155***REMOVED*** | #x1159 |
[#x115F-#x1161***REMOVED*** | #x1163 | #x1165 | #x1167 | #x1169 | [#x116D-#x116E***REMOVED*** |
[#x1172-#x1173***REMOVED*** | #x1175 | #x119E | #x11A8 | #x11AB | [#x11AE-#x11AF***REMOVED*** |
[#x11B7-#x11B8***REMOVED*** | #x11BA | [#x11BC-#x11C2***REMOVED*** | #x11EB | #x11F0 | #x11F9 |
[#x1E00-#x1E9B***REMOVED*** | [#x1EA0-#x1EF9***REMOVED*** | [#x1F00-#x1F15***REMOVED*** | [#x1F18-#x1F1D***REMOVED*** |
[#x1F20-#x1F45***REMOVED*** | [#x1F48-#x1F4D***REMOVED*** | [#x1F50-#x1F57***REMOVED*** | #x1F59 | #x1F5B |
#x1F5D | [#x1F5F-#x1F7D***REMOVED*** | [#x1F80-#x1FB4***REMOVED*** | [#x1FB6-#x1FBC***REMOVED*** | #x1FBE |
[#x1FC2-#x1FC4***REMOVED*** | [#x1FC6-#x1FCC***REMOVED*** | [#x1FD0-#x1FD3***REMOVED*** | [#x1FD6-#x1FDB***REMOVED*** |
[#x1FE0-#x1FEC***REMOVED*** | [#x1FF2-#x1FF4***REMOVED*** | [#x1FF6-#x1FFC***REMOVED*** | #x2126 |
[#x212A-#x212B***REMOVED*** | #x212E | [#x2180-#x2182***REMOVED*** | [#x3041-#x3094***REMOVED*** |
[#x30A1-#x30FA***REMOVED*** | [#x3105-#x312C***REMOVED*** | [#xAC00-#xD7A3***REMOVED******REMOVED***

ideographic = ***REMOVED***[#x4E00-#x9FA5***REMOVED*** | #x3007 | [#x3021-#x3029***REMOVED******REMOVED***

combiningCharacter = ***REMOVED***
[#x0300-#x0345***REMOVED*** | [#x0360-#x0361***REMOVED*** | [#x0483-#x0486***REMOVED*** | [#x0591-#x05A1***REMOVED*** |
[#x05A3-#x05B9***REMOVED*** | [#x05BB-#x05BD***REMOVED*** | #x05BF | [#x05C1-#x05C2***REMOVED*** | #x05C4 |
[#x064B-#x0652***REMOVED*** | #x0670 | [#x06D6-#x06DC***REMOVED*** | [#x06DD-#x06DF***REMOVED*** |
[#x06E0-#x06E4***REMOVED*** | [#x06E7-#x06E8***REMOVED*** | [#x06EA-#x06ED***REMOVED*** | [#x0901-#x0903***REMOVED*** |
#x093C | [#x093E-#x094C***REMOVED*** | #x094D | [#x0951-#x0954***REMOVED*** | [#x0962-#x0963***REMOVED*** |
[#x0981-#x0983***REMOVED*** | #x09BC | #x09BE | #x09BF | [#x09C0-#x09C4***REMOVED*** |
[#x09C7-#x09C8***REMOVED*** | [#x09CB-#x09CD***REMOVED*** | #x09D7 | [#x09E2-#x09E3***REMOVED*** | #x0A02 |
#x0A3C | #x0A3E | #x0A3F | [#x0A40-#x0A42***REMOVED*** | [#x0A47-#x0A48***REMOVED*** |
[#x0A4B-#x0A4D***REMOVED*** | [#x0A70-#x0A71***REMOVED*** | [#x0A81-#x0A83***REMOVED*** | #x0ABC |
[#x0ABE-#x0AC5***REMOVED*** | [#x0AC7-#x0AC9***REMOVED*** | [#x0ACB-#x0ACD***REMOVED*** | [#x0B01-#x0B03***REMOVED*** |
#x0B3C | [#x0B3E-#x0B43***REMOVED*** | [#x0B47-#x0B48***REMOVED*** | [#x0B4B-#x0B4D***REMOVED*** |
[#x0B56-#x0B57***REMOVED*** | [#x0B82-#x0B83***REMOVED*** | [#x0BBE-#x0BC2***REMOVED*** | [#x0BC6-#x0BC8***REMOVED*** |
[#x0BCA-#x0BCD***REMOVED*** | #x0BD7 | [#x0C01-#x0C03***REMOVED*** | [#x0C3E-#x0C44***REMOVED*** |
[#x0C46-#x0C48***REMOVED*** | [#x0C4A-#x0C4D***REMOVED*** | [#x0C55-#x0C56***REMOVED*** | [#x0C82-#x0C83***REMOVED*** |
[#x0CBE-#x0CC4***REMOVED*** | [#x0CC6-#x0CC8***REMOVED*** | [#x0CCA-#x0CCD***REMOVED*** | [#x0CD5-#x0CD6***REMOVED*** |
[#x0D02-#x0D03***REMOVED*** | [#x0D3E-#x0D43***REMOVED*** | [#x0D46-#x0D48***REMOVED*** | [#x0D4A-#x0D4D***REMOVED*** |
#x0D57 | #x0E31 | [#x0E34-#x0E3A***REMOVED*** | [#x0E47-#x0E4E***REMOVED*** | #x0EB1 |
[#x0EB4-#x0EB9***REMOVED*** | [#x0EBB-#x0EBC***REMOVED*** | [#x0EC8-#x0ECD***REMOVED*** | [#x0F18-#x0F19***REMOVED*** |
#x0F35 | #x0F37 | #x0F39 | #x0F3E | #x0F3F | [#x0F71-#x0F84***REMOVED*** |
[#x0F86-#x0F8B***REMOVED*** | [#x0F90-#x0F95***REMOVED*** | #x0F97 | [#x0F99-#x0FAD***REMOVED*** |
[#x0FB1-#x0FB7***REMOVED*** | #x0FB9 | [#x20D0-#x20DC***REMOVED*** | #x20E1 | [#x302A-#x302F***REMOVED*** |
#x3099 | #x309A***REMOVED***

digit = ***REMOVED***
[#x0030-#x0039***REMOVED*** | [#x0660-#x0669***REMOVED*** | [#x06F0-#x06F9***REMOVED*** | [#x0966-#x096F***REMOVED*** |
[#x09E6-#x09EF***REMOVED*** | [#x0A66-#x0A6F***REMOVED*** | [#x0AE6-#x0AEF***REMOVED*** | [#x0B66-#x0B6F***REMOVED*** |
[#x0BE7-#x0BEF***REMOVED*** | [#x0C66-#x0C6F***REMOVED*** | [#x0CE6-#x0CEF***REMOVED*** | [#x0D66-#x0D6F***REMOVED*** |
[#x0E50-#x0E59***REMOVED*** | [#x0ED0-#x0ED9***REMOVED*** | [#x0F20-#x0F29***REMOVED******REMOVED***

extender = ***REMOVED***
#x00B7 | #x02D0 | #x02D1 | #x0387 | #x0640 | #x0E46 | #x0EC6 | #x3005 |
#[#x3031-#x3035***REMOVED*** | [#x309D-#x309E***REMOVED*** | [#x30FC-#x30FE***REMOVED******REMOVED***

letter = " | ".join([baseChar, ideographic***REMOVED******REMOVED***

# Without the
name = " | ".join([letter, digit, ".", "-", "_", combiningCharacter,
                   extender***REMOVED******REMOVED***
nameFirst = " | ".join([letter, "_"***REMOVED******REMOVED***

reChar = re.compile(r"#x([\d|A-F***REMOVED***{4,4***REMOVED******REMOVED***"***REMOVED***
reCharRange = re.compile(r"\[#x([\d|A-F***REMOVED***{4,4***REMOVED******REMOVED***-#x([\d|A-F***REMOVED***{4,4***REMOVED******REMOVED***\***REMOVED***"***REMOVED***


def charStringToList(chars***REMOVED***:
    charRanges = [item.strip(***REMOVED*** for item in chars.split(" | "***REMOVED******REMOVED***
    rv = [***REMOVED***
    for item in charRanges:
        foundMatch = False
        for regexp in (reChar, reCharRange***REMOVED***:
            match = regexp.match(item***REMOVED***
            if match is not None:
                rv.append([hexToInt(item***REMOVED*** for item in match.groups(***REMOVED******REMOVED******REMOVED***
                if len(rv[-1***REMOVED******REMOVED*** == 1:
                    rv[-1***REMOVED*** = rv[-1***REMOVED*** * 2
                foundMatch = True
                break
        if not foundMatch:
            assert len(item***REMOVED*** == 1

            rv.append([ord(item***REMOVED******REMOVED*** * 2***REMOVED***
    rv = normaliseCharList(rv***REMOVED***
    return rv


def normaliseCharList(charList***REMOVED***:
    charList = sorted(charList***REMOVED***
    for item in charList:
        assert item[1***REMOVED*** >= item[0***REMOVED***
    rv = [***REMOVED***
    i = 0
    while i < len(charList***REMOVED***:
        j = 1
        rv.append(charList[i***REMOVED******REMOVED***
        while i + j < len(charList***REMOVED*** and charList[i + j***REMOVED***[0***REMOVED*** <= rv[-1***REMOVED***[1***REMOVED*** + 1:
            rv[-1***REMOVED***[1***REMOVED*** = charList[i + j***REMOVED***[1***REMOVED***
            j += 1
        i += j
    return rv

# We don't really support characters above the BMP :(
max_unicode = int("FFFF", 16***REMOVED***


def missingRanges(charList***REMOVED***:
    rv = [***REMOVED***
    if charList[0***REMOVED*** != 0:
        rv.append([0, charList[0***REMOVED***[0***REMOVED*** - 1***REMOVED******REMOVED***
    for i, item in enumerate(charList[:-1***REMOVED******REMOVED***:
        rv.append([item[1***REMOVED*** + 1, charList[i + 1***REMOVED***[0***REMOVED*** - 1***REMOVED******REMOVED***
    if charList[-1***REMOVED***[1***REMOVED*** != max_unicode:
        rv.append([charList[-1***REMOVED***[1***REMOVED*** + 1, max_unicode***REMOVED******REMOVED***
    return rv


def listToRegexpStr(charList***REMOVED***:
    rv = [***REMOVED***
    for item in charList:
        if item[0***REMOVED*** == item[1***REMOVED***:
            rv.append(escapeRegexp(chr(item[0***REMOVED******REMOVED******REMOVED******REMOVED***
        else:
            rv.append(escapeRegexp(chr(item[0***REMOVED******REMOVED******REMOVED*** + "-" +
                      escapeRegexp(chr(item[1***REMOVED******REMOVED******REMOVED******REMOVED***
    return "[%s***REMOVED***" % "".join(rv***REMOVED***


def hexToInt(hex_str***REMOVED***:
    return int(hex_str, 16***REMOVED***


def escapeRegexp(string***REMOVED***:
    specialCharacters = (".", "^", "$", "*", "+", "?", "{", "***REMOVED***",
                         "[", "***REMOVED***", "|", "(", "***REMOVED***", "-"***REMOVED***
    for char in specialCharacters:
        string = string.replace(char, "\\" + char***REMOVED***

    return string

# output from the above
nonXmlNameBMPRegexp = re.compile('[\x00-,/:-@\\[-\\^`\\{-\xb6\xb8-\xbf\xd7\xf7\u0132-\u0133\u013f-\u0140\u0149\u017f\u01c4-\u01cc\u01f1-\u01f3\u01f6-\u01f9\u0218-\u024f\u02a9-\u02ba\u02c2-\u02cf\u02d2-\u02ff\u0346-\u035f\u0362-\u0385\u038b\u038d\u03a2\u03cf\u03d7-\u03d9\u03db\u03dd\u03df\u03e1\u03f4-\u0400\u040d\u0450\u045d\u0482\u0487-\u048f\u04c5-\u04c6\u04c9-\u04ca\u04cd-\u04cf\u04ec-\u04ed\u04f6-\u04f7\u04fa-\u0530\u0557-\u0558\u055a-\u0560\u0587-\u0590\u05a2\u05ba\u05be\u05c0\u05c3\u05c5-\u05cf\u05eb-\u05ef\u05f3-\u0620\u063b-\u063f\u0653-\u065f\u066a-\u066f\u06b8-\u06b9\u06bf\u06cf\u06d4\u06e9\u06ee-\u06ef\u06fa-\u0900\u0904\u093a-\u093b\u094e-\u0950\u0955-\u0957\u0964-\u0965\u0970-\u0980\u0984\u098d-\u098e\u0991-\u0992\u09a9\u09b1\u09b3-\u09b5\u09ba-\u09bb\u09bd\u09c5-\u09c6\u09c9-\u09ca\u09ce-\u09d6\u09d8-\u09db\u09de\u09e4-\u09e5\u09f2-\u0a01\u0a03-\u0a04\u0a0b-\u0a0e\u0a11-\u0a12\u0a29\u0a31\u0a34\u0a37\u0a3a-\u0a3b\u0a3d\u0a43-\u0a46\u0a49-\u0a4a\u0a4e-\u0a58\u0a5d\u0a5f-\u0a65\u0a75-\u0a80\u0a84\u0a8c\u0a8e\u0a92\u0aa9\u0ab1\u0ab4\u0aba-\u0abb\u0ac6\u0aca\u0ace-\u0adf\u0ae1-\u0ae5\u0af0-\u0b00\u0b04\u0b0d-\u0b0e\u0b11-\u0b12\u0b29\u0b31\u0b34-\u0b35\u0b3a-\u0b3b\u0b44-\u0b46\u0b49-\u0b4a\u0b4e-\u0b55\u0b58-\u0b5b\u0b5e\u0b62-\u0b65\u0b70-\u0b81\u0b84\u0b8b-\u0b8d\u0b91\u0b96-\u0b98\u0b9b\u0b9d\u0ba0-\u0ba2\u0ba5-\u0ba7\u0bab-\u0bad\u0bb6\u0bba-\u0bbd\u0bc3-\u0bc5\u0bc9\u0bce-\u0bd6\u0bd8-\u0be6\u0bf0-\u0c00\u0c04\u0c0d\u0c11\u0c29\u0c34\u0c3a-\u0c3d\u0c45\u0c49\u0c4e-\u0c54\u0c57-\u0c5f\u0c62-\u0c65\u0c70-\u0c81\u0c84\u0c8d\u0c91\u0ca9\u0cb4\u0cba-\u0cbd\u0cc5\u0cc9\u0cce-\u0cd4\u0cd7-\u0cdd\u0cdf\u0ce2-\u0ce5\u0cf0-\u0d01\u0d04\u0d0d\u0d11\u0d29\u0d3a-\u0d3d\u0d44-\u0d45\u0d49\u0d4e-\u0d56\u0d58-\u0d5f\u0d62-\u0d65\u0d70-\u0e00\u0e2f\u0e3b-\u0e3f\u0e4f\u0e5a-\u0e80\u0e83\u0e85-\u0e86\u0e89\u0e8b-\u0e8c\u0e8e-\u0e93\u0e98\u0ea0\u0ea4\u0ea6\u0ea8-\u0ea9\u0eac\u0eaf\u0eba\u0ebe-\u0ebf\u0ec5\u0ec7\u0ece-\u0ecf\u0eda-\u0f17\u0f1a-\u0f1f\u0f2a-\u0f34\u0f36\u0f38\u0f3a-\u0f3d\u0f48\u0f6a-\u0f70\u0f85\u0f8c-\u0f8f\u0f96\u0f98\u0fae-\u0fb0\u0fb8\u0fba-\u109f\u10c6-\u10cf\u10f7-\u10ff\u1101\u1104\u1108\u110a\u110d\u1113-\u113b\u113d\u113f\u1141-\u114b\u114d\u114f\u1151-\u1153\u1156-\u1158\u115a-\u115e\u1162\u1164\u1166\u1168\u116a-\u116c\u116f-\u1171\u1174\u1176-\u119d\u119f-\u11a7\u11a9-\u11aa\u11ac-\u11ad\u11b0-\u11b6\u11b9\u11bb\u11c3-\u11ea\u11ec-\u11ef\u11f1-\u11f8\u11fa-\u1dff\u1e9c-\u1e9f\u1efa-\u1eff\u1f16-\u1f17\u1f1e-\u1f1f\u1f46-\u1f47\u1f4e-\u1f4f\u1f58\u1f5a\u1f5c\u1f5e\u1f7e-\u1f7f\u1fb5\u1fbd\u1fbf-\u1fc1\u1fc5\u1fcd-\u1fcf\u1fd4-\u1fd5\u1fdc-\u1fdf\u1fed-\u1ff1\u1ff5\u1ffd-\u20cf\u20dd-\u20e0\u20e2-\u2125\u2127-\u2129\u212c-\u212d\u212f-\u217f\u2183-\u3004\u3006\u3008-\u3020\u3030\u3036-\u3040\u3095-\u3098\u309b-\u309c\u309f-\u30a0\u30fb\u30ff-\u3104\u312d-\u4dff\u9fa6-\uabff\ud7a4-\uffff***REMOVED***'***REMOVED***

nonXmlNameFirstBMPRegexp = re.compile('[\x00-@\\[-\\^`\\{-\xbf\xd7\xf7\u0132-\u0133\u013f-\u0140\u0149\u017f\u01c4-\u01cc\u01f1-\u01f3\u01f6-\u01f9\u0218-\u024f\u02a9-\u02ba\u02c2-\u0385\u0387\u038b\u038d\u03a2\u03cf\u03d7-\u03d9\u03db\u03dd\u03df\u03e1\u03f4-\u0400\u040d\u0450\u045d\u0482-\u048f\u04c5-\u04c6\u04c9-\u04ca\u04cd-\u04cf\u04ec-\u04ed\u04f6-\u04f7\u04fa-\u0530\u0557-\u0558\u055a-\u0560\u0587-\u05cf\u05eb-\u05ef\u05f3-\u0620\u063b-\u0640\u064b-\u0670\u06b8-\u06b9\u06bf\u06cf\u06d4\u06d6-\u06e4\u06e7-\u0904\u093a-\u093c\u093e-\u0957\u0962-\u0984\u098d-\u098e\u0991-\u0992\u09a9\u09b1\u09b3-\u09b5\u09ba-\u09db\u09de\u09e2-\u09ef\u09f2-\u0a04\u0a0b-\u0a0e\u0a11-\u0a12\u0a29\u0a31\u0a34\u0a37\u0a3a-\u0a58\u0a5d\u0a5f-\u0a71\u0a75-\u0a84\u0a8c\u0a8e\u0a92\u0aa9\u0ab1\u0ab4\u0aba-\u0abc\u0abe-\u0adf\u0ae1-\u0b04\u0b0d-\u0b0e\u0b11-\u0b12\u0b29\u0b31\u0b34-\u0b35\u0b3a-\u0b3c\u0b3e-\u0b5b\u0b5e\u0b62-\u0b84\u0b8b-\u0b8d\u0b91\u0b96-\u0b98\u0b9b\u0b9d\u0ba0-\u0ba2\u0ba5-\u0ba7\u0bab-\u0bad\u0bb6\u0bba-\u0c04\u0c0d\u0c11\u0c29\u0c34\u0c3a-\u0c5f\u0c62-\u0c84\u0c8d\u0c91\u0ca9\u0cb4\u0cba-\u0cdd\u0cdf\u0ce2-\u0d04\u0d0d\u0d11\u0d29\u0d3a-\u0d5f\u0d62-\u0e00\u0e2f\u0e31\u0e34-\u0e3f\u0e46-\u0e80\u0e83\u0e85-\u0e86\u0e89\u0e8b-\u0e8c\u0e8e-\u0e93\u0e98\u0ea0\u0ea4\u0ea6\u0ea8-\u0ea9\u0eac\u0eaf\u0eb1\u0eb4-\u0ebc\u0ebe-\u0ebf\u0ec5-\u0f3f\u0f48\u0f6a-\u109f\u10c6-\u10cf\u10f7-\u10ff\u1101\u1104\u1108\u110a\u110d\u1113-\u113b\u113d\u113f\u1141-\u114b\u114d\u114f\u1151-\u1153\u1156-\u1158\u115a-\u115e\u1162\u1164\u1166\u1168\u116a-\u116c\u116f-\u1171\u1174\u1176-\u119d\u119f-\u11a7\u11a9-\u11aa\u11ac-\u11ad\u11b0-\u11b6\u11b9\u11bb\u11c3-\u11ea\u11ec-\u11ef\u11f1-\u11f8\u11fa-\u1dff\u1e9c-\u1e9f\u1efa-\u1eff\u1f16-\u1f17\u1f1e-\u1f1f\u1f46-\u1f47\u1f4e-\u1f4f\u1f58\u1f5a\u1f5c\u1f5e\u1f7e-\u1f7f\u1fb5\u1fbd\u1fbf-\u1fc1\u1fc5\u1fcd-\u1fcf\u1fd4-\u1fd5\u1fdc-\u1fdf\u1fed-\u1ff1\u1ff5\u1ffd-\u2125\u2127-\u2129\u212c-\u212d\u212f-\u217f\u2183-\u3006\u3008-\u3020\u302a-\u3040\u3095-\u30a0\u30fb-\u3104\u312d-\u4dff\u9fa6-\uabff\ud7a4-\uffff***REMOVED***'***REMOVED***

# Simpler things
nonPubidCharRegexp = re.compile("[^\x20\x0D\x0Aa-zA-Z0-9\-\'(***REMOVED***+,./:=?;!*#@$_%***REMOVED***"***REMOVED***


class InfosetFilter(object***REMOVED***:
    replacementRegexp = re.compile(r"U[\dA-F***REMOVED***{5,5***REMOVED***"***REMOVED***

    def __init__(self, replaceChars=None,
                 dropXmlnsLocalName=False,
                 dropXmlnsAttrNs=False,
                 preventDoubleDashComments=False,
                 preventDashAtCommentEnd=False,
                 replaceFormFeedCharacters=True,
                 preventSingleQuotePubid=False***REMOVED***:

        self.dropXmlnsLocalName = dropXmlnsLocalName
        self.dropXmlnsAttrNs = dropXmlnsAttrNs

        self.preventDoubleDashComments = preventDoubleDashComments
        self.preventDashAtCommentEnd = preventDashAtCommentEnd

        self.replaceFormFeedCharacters = replaceFormFeedCharacters

        self.preventSingleQuotePubid = preventSingleQuotePubid

        self.replaceCache = {***REMOVED***

    def coerceAttribute(self, name, namespace=None***REMOVED***:
        if self.dropXmlnsLocalName and name.startswith("xmlns:"***REMOVED***:
            warnings.warn("Attributes cannot begin with xmlns", DataLossWarning***REMOVED***
            return None
        elif (self.dropXmlnsAttrNs and
              namespace == "http://www.w3.org/2000/xmlns/"***REMOVED***:
            warnings.warn("Attributes cannot be in the xml namespace", DataLossWarning***REMOVED***
            return None
        else:
            return self.toXmlName(name***REMOVED***

    def coerceElement(self, name, namespace=None***REMOVED***:
        return self.toXmlName(name***REMOVED***

    def coerceComment(self, data***REMOVED***:
        if self.preventDoubleDashComments:
            while "--" in data:
                warnings.warn("Comments cannot contain adjacent dashes", DataLossWarning***REMOVED***
                data = data.replace("--", "- -"***REMOVED***
        return data

    def coerceCharacters(self, data***REMOVED***:
        if self.replaceFormFeedCharacters:
            for i in range(data.count("\x0C"***REMOVED******REMOVED***:
                warnings.warn("Text cannot contain U+000C", DataLossWarning***REMOVED***
            data = data.replace("\x0C", " "***REMOVED***
        # Other non-xml characters
        return data

    def coercePubid(self, data***REMOVED***:
        dataOutput = data
        for char in nonPubidCharRegexp.findall(data***REMOVED***:
            warnings.warn("Coercing non-XML pubid", DataLossWarning***REMOVED***
            replacement = self.getReplacementCharacter(char***REMOVED***
            dataOutput = dataOutput.replace(char, replacement***REMOVED***
        if self.preventSingleQuotePubid and dataOutput.find("'"***REMOVED*** >= 0:
            warnings.warn("Pubid cannot contain single quote", DataLossWarning***REMOVED***
            dataOutput = dataOutput.replace("'", self.getReplacementCharacter("'"***REMOVED******REMOVED***
        return dataOutput

    def toXmlName(self, name***REMOVED***:
        nameFirst = name[0***REMOVED***
        nameRest = name[1:***REMOVED***
        m = nonXmlNameFirstBMPRegexp.match(nameFirst***REMOVED***
        if m:
            warnings.warn("Coercing non-XML name", DataLossWarning***REMOVED***
            nameFirstOutput = self.getReplacementCharacter(nameFirst***REMOVED***
        else:
            nameFirstOutput = nameFirst

        nameRestOutput = nameRest
        replaceChars = set(nonXmlNameBMPRegexp.findall(nameRest***REMOVED******REMOVED***
        for char in replaceChars:
            warnings.warn("Coercing non-XML name", DataLossWarning***REMOVED***
            replacement = self.getReplacementCharacter(char***REMOVED***
            nameRestOutput = nameRestOutput.replace(char, replacement***REMOVED***
        return nameFirstOutput + nameRestOutput

    def getReplacementCharacter(self, char***REMOVED***:
        if char in self.replaceCache:
            replacement = self.replaceCache[char***REMOVED***
        else:
            replacement = self.escapeChar(char***REMOVED***
        return replacement

    def fromXmlName(self, name***REMOVED***:
        for item in set(self.replacementRegexp.findall(name***REMOVED******REMOVED***:
            name = name.replace(item, self.unescapeChar(item***REMOVED******REMOVED***
        return name

    def escapeChar(self, char***REMOVED***:
        replacement = "U%05X" % ord(char***REMOVED***
        self.replaceCache[char***REMOVED*** = replacement
        return replacement

    def unescapeChar(self, charcode***REMOVED***:
        return chr(int(charcode[1:***REMOVED***, 16***REMOVED******REMOVED***
