from django import http
from django.template import Context, Engine, TemplateDoesNotExist, loader
from django.utils import six
from django.utils.encoding import force_text
from django.views.decorators.csrf import requires_csrf_token

ERROR_404_TEMPLATE_NAME = '404.html'
ERROR_403_TEMPLATE_NAME = '403.html'
ERROR_400_TEMPLATE_NAME = '400.html'
ERROR_500_TEMPLATE_NAME = '500.html'


# This can be called when CsrfViewMiddleware.process_view has not run,
# therefore need @requires_csrf_token in case the template needs
# {% csrf_token %***REMOVED***.
@requires_csrf_token
def page_not_found(request, exception, template_name=ERROR_404_TEMPLATE_NAME***REMOVED***:
    ***REMOVED***
    Default 404 handler.

    Templates: :template:`404.html`
    Context:
        request_path
            The path of the requested URL (e.g., '/app/pages/bad_page/'***REMOVED***
        exception
            The message from the exception which triggered the 404 (if one was
            supplied***REMOVED***, or the exception class name
    ***REMOVED***
    exception_repr = exception.__class__.__name__
    # Try to get an "interesting" exception message, if any (and not the ugly
    # Resolver404 dictionary***REMOVED***
    ***REMOVED***
        message = exception.args[0***REMOVED***
    except (AttributeError, IndexError***REMOVED***:
        pass
    else:
        if isinstance(message, six.text_type***REMOVED***:
            exception_repr = message
    context = {
        'request_path': request.path,
        'exception': exception_repr,
***REMOVED***
    ***REMOVED***
        template = loader.get_template(template_name***REMOVED***
        body = template.render(context, request***REMOVED***
        content_type = None             # Django will use DEFAULT_CONTENT_TYPE
    except TemplateDoesNotExist:
        if template_name != ERROR_404_TEMPLATE_NAME:
            # Reraise if it's a missing custom template.
            raise
        template = Engine(***REMOVED***.from_string(
            '<h1>Not Found</h1>'
            '<p>The requested URL {{ request_path ***REMOVED******REMOVED*** was not found on this server.</p>'***REMOVED***
        body = template.render(Context(context***REMOVED******REMOVED***
        content_type = 'text/html'
    return http.HttpResponseNotFound(body, content_type=content_type***REMOVED***


@requires_csrf_token
def server_error(request, template_name=ERROR_500_TEMPLATE_NAME***REMOVED***:
    ***REMOVED***
    500 error handler.

    Templates: :template:`500.html`
    Context: None
    ***REMOVED***
    ***REMOVED***
        template = loader.get_template(template_name***REMOVED***
    except TemplateDoesNotExist:
        if template_name != ERROR_500_TEMPLATE_NAME:
            # Reraise if it's a missing custom template.
            raise
        return http.HttpResponseServerError('<h1>Server Error (500***REMOVED***</h1>', content_type='text/html'***REMOVED***
    return http.HttpResponseServerError(template.render(***REMOVED******REMOVED***


@requires_csrf_token
def bad_request(request, exception, template_name=ERROR_400_TEMPLATE_NAME***REMOVED***:
    ***REMOVED***
    400 error handler.

    Templates: :template:`400.html`
    Context: None
    ***REMOVED***
    ***REMOVED***
        template = loader.get_template(template_name***REMOVED***
    except TemplateDoesNotExist:
        if template_name != ERROR_400_TEMPLATE_NAME:
            # Reraise if it's a missing custom template.
            raise
        return http.HttpResponseBadRequest('<h1>Bad Request (400***REMOVED***</h1>', content_type='text/html'***REMOVED***
    # No exception content is passed to the template, to not disclose any sensitive information.
    return http.HttpResponseBadRequest(template.render(***REMOVED******REMOVED***


# This can be called when CsrfViewMiddleware.process_view has not run,
# therefore need @requires_csrf_token in case the template needs
# {% csrf_token %***REMOVED***.
@requires_csrf_token
def permission_denied(request, exception, template_name=ERROR_403_TEMPLATE_NAME***REMOVED***:
    ***REMOVED***
    Permission denied (403***REMOVED*** handler.

    Templates: :template:`403.html`
    Context: None

    If the template does not exist, an Http403 response containing the text
    "403 Forbidden" (as per RFC 7231***REMOVED*** will be returned.
    ***REMOVED***
    ***REMOVED***
        template = loader.get_template(template_name***REMOVED***
    except TemplateDoesNotExist:
        if template_name != ERROR_403_TEMPLATE_NAME:
            # Reraise if it's a missing custom template.
            raise
        return http.HttpResponseForbidden('<h1>403 Forbidden</h1>', content_type='text/html'***REMOVED***
    return http.HttpResponseForbidden(
        template.render(request=request, context={'exception': force_text(exception***REMOVED******REMOVED******REMOVED***
    ***REMOVED***
