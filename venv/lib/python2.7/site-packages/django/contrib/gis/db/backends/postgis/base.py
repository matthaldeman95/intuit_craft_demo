from django.db.backends.base.base import NO_DB_ALIAS
from django.db.backends.postgresql.base import \
    DatabaseWrapper as Psycopg2DatabaseWrapper

from .features import DatabaseFeatures
from .introspection import PostGISIntrospection
from .operations import PostGISOperations
from .schema import PostGISSchemaEditor


class DatabaseWrapper(Psycopg2DatabaseWrapper***REMOVED***:
    SchemaEditorClass = PostGISSchemaEditor

    def __init__(self, *args, **kwargs***REMOVED***:
        super(DatabaseWrapper, self***REMOVED***.__init__(*args, **kwargs***REMOVED***
        if kwargs.get('alias', ''***REMOVED*** != NO_DB_ALIAS:
            self.features = DatabaseFeatures(self***REMOVED***
            self.ops = PostGISOperations(self***REMOVED***
            self.introspection = PostGISIntrospection(self***REMOVED***

    def prepare_database(self***REMOVED***:
        super(DatabaseWrapper, self***REMOVED***.prepare_database(***REMOVED***
        # Check that postgis extension is installed.
        with self.cursor(***REMOVED*** as cursor:
            cursor.execute("CREATE EXTENSION IF NOT EXISTS postgis"***REMOVED***
