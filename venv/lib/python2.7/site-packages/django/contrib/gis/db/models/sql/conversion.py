***REMOVED***
This module holds simple classes to convert geospatial values from the
database.
***REMOVED***
from __future__ import unicode_literals

from decimal import Decimal

from django.contrib.gis.db.models.fields import GeoSelectFormatMixin
from django.contrib.gis.geometry.backend import Geometry
from django.contrib.gis.measure import Area, Distance


class BaseField(object***REMOVED***:
    empty_strings_allowed = True

    def get_db_converters(self, connection***REMOVED***:
        return [self.from_db_value***REMOVED***

    def select_format(self, compiler, sql, params***REMOVED***:
        return sql, params


class AreaField(BaseField***REMOVED***:
    "Wrapper for Area values."
    def __init__(self, area_att=None***REMOVED***:
        self.area_att = area_att

    def from_db_value(self, value, expression, connection, context***REMOVED***:
        if connection.features.interprets_empty_strings_as_nulls and value == '':
            value = None
        # If the database returns a Decimal, convert it to a float as expected
        # by the Python geometric objects.
        if isinstance(value, Decimal***REMOVED***:
            value = float(value***REMOVED***
        # If the units are known, convert value into area measure.
        if value is not None and self.area_att:
            value = Area(**{self.area_att: value***REMOVED******REMOVED***
        return value

    def get_internal_type(self***REMOVED***:
        return 'AreaField'


class DistanceField(BaseField***REMOVED***:
    "Wrapper for Distance values."
    def __init__(self, distance_att***REMOVED***:
        self.distance_att = distance_att

    def from_db_value(self, value, expression, connection, context***REMOVED***:
        if value is not None:
            value = Distance(**{self.distance_att: value***REMOVED******REMOVED***
        return value

    def get_internal_type(self***REMOVED***:
        return 'DistanceField'


class GeomField(GeoSelectFormatMixin, BaseField***REMOVED***:
    ***REMOVED***
    Wrapper for Geometry values.  It is a lightweight alternative to
    using GeometryField (which requires an SQL query upon instantiation***REMOVED***.
    ***REMOVED***
    # Hacky marker for get_db_converters(***REMOVED***
    geom_type = None

    def from_db_value(self, value, expression, connection, context***REMOVED***:
        if value is not None:
            value = Geometry(value***REMOVED***
        return value

    def get_internal_type(self***REMOVED***:
        return 'GeometryField'


class GMLField(BaseField***REMOVED***:
    ***REMOVED***
    Wrapper for GML to be used by Oracle to ensure Database.LOB conversion.
    ***REMOVED***

    def get_internal_type(self***REMOVED***:
        return 'GMLField'

    def from_db_value(self, value, expression, connection, context***REMOVED***:
        return value
