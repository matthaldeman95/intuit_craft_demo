from ctypes import POINTER, c_double, c_int, c_uint

from django.contrib.gis.geos.libgeos import CS_PTR, GEOM_PTR, GEOSFuncFactory
from django.contrib.gis.geos.prototypes.errcheck import (
    GEOSException, last_arg_byref,
***REMOVED***


# ## Error-checking routines specific to coordinate sequences. ##
def check_cs_op(result, func, cargs***REMOVED***:
    "Checks the status code of a coordinate sequence operation."
    if result == 0:
        raise GEOSException('Could not set value on coordinate sequence'***REMOVED***
    else:
        return result


def check_cs_get(result, func, cargs***REMOVED***:
    "Checking the coordinate sequence retrieval."
    check_cs_op(result, func, cargs***REMOVED***
    # Object in by reference, return its value.
    return last_arg_byref(cargs***REMOVED***


# ## Coordinate sequence prototype factory classes. ##
class CsInt(GEOSFuncFactory***REMOVED***:
    "For coordinate sequence routines that return an integer."
    argtypes = [CS_PTR, POINTER(c_uint***REMOVED******REMOVED***
    restype = c_int
    errcheck = staticmethod(check_cs_get***REMOVED***


class CsOperation(GEOSFuncFactory***REMOVED***:
    "For coordinate sequence operations."
    restype = c_int

    def get_func(self, ordinate=False, get=False***REMOVED***:
        if get:
            # Get routines have double parameter passed-in by reference.
            self.errcheck = check_cs_get
            dbl_param = POINTER(c_double***REMOVED***
        else:
            self.errcheck = check_cs_op
            dbl_param = c_double

        if ordinate:
            # Get/Set ordinate routines have an extra uint parameter.
            self.argtypes = [CS_PTR, c_uint, c_uint, dbl_param***REMOVED***
        else:
            self.argtypes = [CS_PTR, c_uint, dbl_param***REMOVED***
        return super(CsOperation, self***REMOVED***.get_func(***REMOVED***


class CsOutput(GEOSFuncFactory***REMOVED***:
    restype = CS_PTR

    def get_func(self, argtypes***REMOVED***:
        self.argtypes = argtypes
        return super(CsOutput, self***REMOVED***.get_func(***REMOVED***

    @staticmethod
    def errcheck(result, func, cargs***REMOVED***:
        if not result:
            raise GEOSException(
                'Error encountered checking Coordinate Sequence returned from GEOS '
                'C function "%s".' % func.__name__
            ***REMOVED***
        return result


# ## Coordinate Sequence ctypes prototypes ##

# Coordinate Sequence constructors & cloning.
cs_clone = CsOutput('GEOSCoordSeq_clone', [CS_PTR***REMOVED******REMOVED***
create_cs = CsOutput('GEOSCoordSeq_create', [c_uint, c_uint***REMOVED******REMOVED***
get_cs = CsOutput('GEOSGeom_getCoordSeq', [GEOM_PTR***REMOVED******REMOVED***

# Getting, setting ordinate
cs_getordinate = CsOperation('GEOSCoordSeq_getOrdinate', ordinate=True, get=True***REMOVED***
cs_setordinate = CsOperation('GEOSCoordSeq_setOrdinate', ordinate=True***REMOVED***

# For getting, x, y, z
cs_getx = CsOperation('GEOSCoordSeq_getX', get=True***REMOVED***
cs_gety = CsOperation('GEOSCoordSeq_getY', get=True***REMOVED***
cs_getz = CsOperation('GEOSCoordSeq_getZ', get=True***REMOVED***

# For setting, x, y, z
cs_setx = CsOperation('GEOSCoordSeq_setX'***REMOVED***
cs_sety = CsOperation('GEOSCoordSeq_setY'***REMOVED***
cs_setz = CsOperation('GEOSCoordSeq_setZ'***REMOVED***

# These routines return size & dimensions.
cs_getsize = CsInt('GEOSCoordSeq_getSize'***REMOVED***
cs_getdims = CsInt('GEOSCoordSeq_getDimensions'***REMOVED***
