import json

from django import forms
from django.utils import six
from django.utils.translation import ugettext_lazy as _

__all__ = ['JSONField'***REMOVED***


class InvalidJSONInput(six.text_type***REMOVED***:
    pass


class JSONField(forms.CharField***REMOVED***:
    default_error_messages = {
        'invalid': _("'%(value***REMOVED***s' value must be valid JSON."***REMOVED***,
***REMOVED***

    def __init__(self, **kwargs***REMOVED***:
        kwargs.setdefault('widget', forms.Textarea***REMOVED***
        super(JSONField, self***REMOVED***.__init__(**kwargs***REMOVED***

    def to_python(self, value***REMOVED***:
        if self.disabled:
            return value
        if value in self.empty_values:
            return None
        ***REMOVED***
            return json.loads(value***REMOVED***
        except ValueError:
            raise forms.ValidationError(
                self.error_messages['invalid'***REMOVED***,
                code='invalid',
                params={'value': value***REMOVED***,
            ***REMOVED***

    def bound_data(self, data, initial***REMOVED***:
        if self.disabled:
            return initial
        ***REMOVED***
            return json.loads(data***REMOVED***
        except ValueError:
            return InvalidJSONInput(data***REMOVED***

    def prepare_value(self, value***REMOVED***:
        if isinstance(value, InvalidJSONInput***REMOVED***:
            return value
        return json.dumps(value***REMOVED***
