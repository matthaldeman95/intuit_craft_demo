# -*- coding: utf-8 -
#
# This file is part of gunicorn released under the MIT license.
# See the NOTICE for more information.

***REMOVED***
import sys

from gunicorn.errors import ConfigError
from gunicorn.app.base import Application
from gunicorn import util


class WSGIApplication(Application***REMOVED***:
    def init(self, parser, opts, args***REMOVED***:
        if opts.paste and opts.paste is not None:
            app_name = 'main'
            path = opts.paste
            if '#' in path:
                path, app_name = path.split('#'***REMOVED***
            path = os.path.abspath(os.path.normpath(
                os.path.join(util.getcwd(***REMOVED***, path***REMOVED******REMOVED******REMOVED***

            if not os.path.exists(path***REMOVED***:
                raise ConfigError("%r not found" % path***REMOVED***

            # paste application, load the config
            self.cfgurl = 'config:%s#%s' % (path, app_name***REMOVED***
            self.relpath = os.path.dirname(path***REMOVED***

            from .pasterapp import paste_config
            return paste_config(self.cfg, self.cfgurl, self.relpath***REMOVED***

        if len(args***REMOVED*** < 1:
            parser.error("No application module specified."***REMOVED***

        self.cfg.set("default_proc_name", args[0***REMOVED******REMOVED***
        self.app_uri = args[0***REMOVED***

    def chdir(self***REMOVED***:
        # chdir to the configured path before loading,
        # default is the current dir
        os.chdir(self.cfg.chdir***REMOVED***

        # add the path to sys.path
        sys.path.insert(0, self.cfg.chdir***REMOVED***

    def load_wsgiapp(self***REMOVED***:
        self.chdir(***REMOVED***

        # load the app
        return util.import_app(self.app_uri***REMOVED***

    def load_pasteapp(self***REMOVED***:
        self.chdir(***REMOVED***

        # load the paste app
        from .pasterapp import load_pasteapp
        return load_pasteapp(self.cfgurl, self.relpath, global_conf=None***REMOVED***

    def load(self***REMOVED***:
        if self.cfg.paste is not None:
            return self.load_pasteapp(***REMOVED***
        else:
            return self.load_wsgiapp(***REMOVED***


def run(***REMOVED***:
    ***REMOVED***\
    The ``gunicorn`` command line runner for launching Gunicorn with
    generic WSGI applications.
    ***REMOVED***
    from gunicorn.app.wsgiapp import WSGIApplication
    WSGIApplication("%(prog***REMOVED***s [OPTIONS***REMOVED*** [APP_MODULE***REMOVED***"***REMOVED***.run(***REMOVED***


if __name__ == '__main__':
    run(***REMOVED***
