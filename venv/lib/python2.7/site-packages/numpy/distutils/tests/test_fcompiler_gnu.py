from __future__ import division, absolute_import, print_function

from numpy.testing import TestCase, assert_, run_module_suite

import numpy.distutils.fcompiler

g77_version_strings = [
    ('GNU Fortran 0.5.25 20010319 (prerelease***REMOVED***', '0.5.25'***REMOVED***,
    ('GNU Fortran (GCC 3.2***REMOVED*** 3.2 20020814 (release***REMOVED***', '3.2'***REMOVED***,
    ('GNU Fortran (GCC***REMOVED*** 3.3.3 20040110 (prerelease***REMOVED*** (Debian***REMOVED***', '3.3.3'***REMOVED***,
    ('GNU Fortran (GCC***REMOVED*** 3.3.3 (Debian 20040401***REMOVED***', '3.3.3'***REMOVED***,
    ('GNU Fortran (GCC 3.2.2 20030222 (Red Hat Linux 3.2.2-5***REMOVED******REMOVED*** 3.2.2'
       ' 20030222 (Red Hat Linux 3.2.2-5***REMOVED***', '3.2.2'***REMOVED***,
***REMOVED***

gfortran_version_strings = [
    ('GNU Fortran 95 (GCC 4.0.3 20051023 (prerelease***REMOVED*** (Debian 4.0.2-3***REMOVED******REMOVED***',
     '4.0.3'***REMOVED***,
    ('GNU Fortran 95 (GCC***REMOVED*** 4.1.0', '4.1.0'***REMOVED***,
    ('GNU Fortran 95 (GCC***REMOVED*** 4.2.0 20060218 (experimental***REMOVED***', '4.2.0'***REMOVED***,
    ('GNU Fortran (GCC***REMOVED*** 4.3.0 20070316 (experimental***REMOVED***', '4.3.0'***REMOVED***,
    ('GNU Fortran (rubenvb-4.8.0***REMOVED*** 4.8.0', '4.8.0'***REMOVED***,
    ('4.8.0', '4.8.0'***REMOVED***,
    ('4.0.3-7', '4.0.3'***REMOVED***,
    ("gfortran: warning: couldn't understand kern.osversion '14.1.0\n4.9.1",
     '4.9.1'***REMOVED***,
    ("gfortran: warning: couldn't understand kern.osversion '14.1.0\n"
     "gfortran: warning: yet another warning\n4.9.1",
     '4.9.1'***REMOVED***
***REMOVED***

class TestG77Versions(TestCase***REMOVED***:
    def test_g77_version(self***REMOVED***:
        fc = numpy.distutils.fcompiler.new_fcompiler(compiler='gnu'***REMOVED***
        for vs, version in g77_version_strings:
            v = fc.version_match(vs***REMOVED***
            assert_(v == version, (vs, v***REMOVED******REMOVED***

    def test_not_g77(self***REMOVED***:
        fc = numpy.distutils.fcompiler.new_fcompiler(compiler='gnu'***REMOVED***
        for vs, _ in gfortran_version_strings:
            v = fc.version_match(vs***REMOVED***
            assert_(v is None, (vs, v***REMOVED******REMOVED***

class TestGFortranVersions(TestCase***REMOVED***:
    def test_gfortran_version(self***REMOVED***:
        fc = numpy.distutils.fcompiler.new_fcompiler(compiler='gnu95'***REMOVED***
        for vs, version in gfortran_version_strings:
            v = fc.version_match(vs***REMOVED***
            assert_(v == version, (vs, v***REMOVED******REMOVED***

    def test_not_gfortran(self***REMOVED***:
        fc = numpy.distutils.fcompiler.new_fcompiler(compiler='gnu95'***REMOVED***
        for vs, _ in g77_version_strings:
            v = fc.version_match(vs***REMOVED***
            assert_(v is None, (vs, v***REMOVED******REMOVED***


if __name__ == '__main__':
    run_module_suite(***REMOVED***
