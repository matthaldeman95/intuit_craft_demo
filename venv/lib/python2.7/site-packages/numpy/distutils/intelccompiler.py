from __future__ import division, absolute_import, print_function

import platform

from distutils.unixccompiler import UnixCCompiler
from numpy.distutils.exec_command import find_executable
from numpy.distutils.ccompiler import simple_version_match
if platform.system(***REMOVED*** == 'Windows':
    from numpy.distutils.msvc9compiler import MSVCCompiler


class IntelCCompiler(UnixCCompiler***REMOVED***:
    ***REMOVED***A modified Intel compiler compatible with a GCC-built Python.***REMOVED***
    compiler_type = 'intel'
    cc_exe = 'icc'
    cc_args = 'fPIC'

    def __init__(self, verbose=0, dry_run=0, force=0***REMOVED***:
        UnixCCompiler.__init__(self, verbose, dry_run, force***REMOVED***
        self.cc_exe = ('icc -fPIC -fp-model strict -O3 '
                       '-fomit-frame-pointer -openmp'***REMOVED***
        compiler = self.cc_exe
        if platform.system(***REMOVED*** == 'Darwin':
            shared_flag = '-Wl,-undefined,dynamic_lookup'
        else:
            shared_flag = '-shared'
        self.set_executables(compiler=compiler,
                             compiler_so=compiler,
                             compiler_cxx=compiler,
                             archiver='xiar' + ' cru',
                             linker_exe=compiler + ' -shared-intel',
                             linker_so=compiler + ' ' + shared_flag +
                             ' -shared-intel'***REMOVED***


class IntelItaniumCCompiler(IntelCCompiler***REMOVED***:
    compiler_type = 'intele'

    # On Itanium, the Intel Compiler used to be called ecc, let's search for
    # it (now it's also icc, so ecc is last in the search***REMOVED***.
    for cc_exe in map(find_executable, ['icc', 'ecc'***REMOVED******REMOVED***:
        if cc_exe:
            break


class IntelEM64TCCompiler(UnixCCompiler***REMOVED***:
    ***REMOVED***
    A modified Intel x86_64 compiler compatible with a 64bit GCC-built Python.
    ***REMOVED***
    compiler_type = 'intelem'
    cc_exe = 'icc -m64'
    cc_args = '-fPIC'

    def __init__(self, verbose=0, dry_run=0, force=0***REMOVED***:
        UnixCCompiler.__init__(self, verbose, dry_run, force***REMOVED***
        self.cc_exe = ('icc -m64 -fPIC -fp-model strict -O3 '
                       '-fomit-frame-pointer -openmp'***REMOVED***
        compiler = self.cc_exe
        if platform.system(***REMOVED*** == 'Darwin':
            shared_flag = '-Wl,-undefined,dynamic_lookup'
        else:
            shared_flag = '-shared'
        self.set_executables(compiler=compiler,
                             compiler_so=compiler,
                             compiler_cxx=compiler,
                             archiver='xiar' + ' cru',
                             linker_exe=compiler + ' -shared-intel',
                             linker_so=compiler + ' ' + shared_flag +
                             ' -shared-intel'***REMOVED***


if platform.system(***REMOVED*** == 'Windows':
    class IntelCCompilerW(MSVCCompiler***REMOVED***:
        ***REMOVED***
        A modified Intel compiler compatible with an MSVC-built Python.
        ***REMOVED***
        compiler_type = 'intelw'
        compiler_cxx = 'icl'

        def __init__(self, verbose=0, dry_run=0, force=0***REMOVED***:
            MSVCCompiler.__init__(self, verbose, dry_run, force***REMOVED***
            version_match = simple_version_match(start='Intel\(R\***REMOVED***.*?32,'***REMOVED***
            self.__version = version_match

        def initialize(self, plat_name=None***REMOVED***:
            MSVCCompiler.initialize(self, plat_name***REMOVED***
            self.cc = self.find_exe('icl.exe'***REMOVED***
            self.lib = self.find_exe('xilib'***REMOVED***
            self.linker = self.find_exe('xilink'***REMOVED***
            self.compile_options = ['/nologo', '/O3', '/MD', '/W3',
                                    '/Qstd=c99'***REMOVED***
            self.compile_options_debug = ['/nologo', '/Od', '/MDd', '/W3',
                                          '/Qstd=c99', '/Z7', '/D_DEBUG'***REMOVED***

    class IntelEM64TCCompilerW(IntelCCompilerW***REMOVED***:
        ***REMOVED***
        A modified Intel x86_64 compiler compatible with
        a 64bit MSVC-built Python.
        ***REMOVED***
        compiler_type = 'intelemw'

        def __init__(self, verbose=0, dry_run=0, force=0***REMOVED***:
            MSVCCompiler.__init__(self, verbose, dry_run, force***REMOVED***
            version_match = simple_version_match(start='Intel\(R\***REMOVED***.*?64,'***REMOVED***
            self.__version = version_match
