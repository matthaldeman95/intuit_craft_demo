from __future__ import division, absolute_import, print_function

import copy
import pickle
import sys
import platform
import gc
import warnings
import tempfile
from os import path
from io import BytesIO
from itertools import chain

import numpy as np
from numpy.testing import (
        run_module_suite, TestCase, assert_, assert_equal,
        assert_almost_equal, assert_array_equal, assert_array_almost_equal,
        assert_raises, assert_warns, dec
        ***REMOVED***
from numpy.testing.utils import _assert_valid_refcount
from numpy.compat import asbytes, asunicode, asbytes_nested, long, sixu

rlevel = 1

class TestRegression(TestCase***REMOVED***:
    def test_invalid_round(self,level=rlevel***REMOVED***:
        # Ticket #3
        v = 4.7599999999999998
        assert_array_equal(np.array([v***REMOVED******REMOVED***, np.array(v***REMOVED******REMOVED***

    def test_mem_empty(self,level=rlevel***REMOVED***:
        # Ticket #7
        np.empty((1,***REMOVED***, dtype=[('x', np.int64***REMOVED******REMOVED******REMOVED***

    def test_pickle_transposed(self,level=rlevel***REMOVED***:
        # Ticket #16
        a = np.transpose(np.array([[2, 9***REMOVED***, [7, 0***REMOVED***, [3, 8***REMOVED******REMOVED******REMOVED******REMOVED***
        f = BytesIO(***REMOVED***
        pickle.dump(a, f***REMOVED***
        f.seek(0***REMOVED***
        b = pickle.load(f***REMOVED***
        f.close(***REMOVED***
        assert_array_equal(a, b***REMOVED***

    def test_typeNA(self,level=rlevel***REMOVED***:
        # Ticket #31
        assert_equal(np.typeNA[np.int64***REMOVED***, 'Int64'***REMOVED***
        assert_equal(np.typeNA[np.uint64***REMOVED***, 'UInt64'***REMOVED***

    def test_dtype_names(self,level=rlevel***REMOVED***:
        # Ticket #35
        # Should succeed
        np.dtype([(('name', 'label'***REMOVED***, np.int32, 3***REMOVED******REMOVED******REMOVED***

    def test_reduce(self,level=rlevel***REMOVED***:
        # Ticket #40
        assert_almost_equal(np.add.reduce([1., .5***REMOVED***, dtype=None***REMOVED***, 1.5***REMOVED***

    def test_zeros_order(self,level=rlevel***REMOVED***:
        # Ticket #43
        np.zeros([3***REMOVED***, int, 'C'***REMOVED***
        np.zeros([3***REMOVED***, order='C'***REMOVED***
        np.zeros([3***REMOVED***, int, order='C'***REMOVED***

    def test_asarray_with_order(self,level=rlevel***REMOVED***:
        # Check that nothing is done when order='F' and array C/F-contiguous
        a = np.ones(2***REMOVED***
        assert_(a is np.asarray(a, order='F'***REMOVED******REMOVED***

    def test_ravel_with_order(self,level=rlevel***REMOVED***:
        # Check that ravel works when order='F' and array C/F-contiguous
        a = np.ones(2***REMOVED***
        assert_(not a.ravel('F'***REMOVED***.flags.owndata***REMOVED***

    def test_sort_bigendian(self,level=rlevel***REMOVED***:
        # Ticket #47
        a = np.linspace(0, 10, 11***REMOVED***
        c = a.astype(np.dtype('<f8'***REMOVED******REMOVED***
        c.sort(***REMOVED***
        assert_array_almost_equal(c, a***REMOVED***

    def test_negative_nd_indexing(self,level=rlevel***REMOVED***:
        # Ticket #49
        c = np.arange(125***REMOVED***.reshape((5, 5, 5***REMOVED******REMOVED***
        origidx = np.array([-1, 0, 1***REMOVED******REMOVED***
        idx = np.array(origidx***REMOVED***
        c[idx***REMOVED***
        assert_array_equal(idx, origidx***REMOVED***

    def test_char_dump(self,level=rlevel***REMOVED***:
        # Ticket #50
        f = BytesIO(***REMOVED***
        ca = np.char.array(np.arange(1000, 1010***REMOVED***, itemsize=4***REMOVED***
        ca.dump(f***REMOVED***
        f.seek(0***REMOVED***
        ca = np.load(f***REMOVED***
        f.close(***REMOVED***

    def test_noncontiguous_fill(self,level=rlevel***REMOVED***:
        # Ticket #58.
        a = np.zeros((5, 3***REMOVED******REMOVED***
        b = a[:, :2,***REMOVED***

        def rs(***REMOVED***:
            b.shape = (10,***REMOVED***

        self.assertRaises(AttributeError, rs***REMOVED***

    def test_bool(self,level=rlevel***REMOVED***:
        # Ticket #60
        np.bool_(1***REMOVED***  # Should succeed

    def test_indexing1(self,level=rlevel***REMOVED***:
        # Ticket #64
        descr = [('x', [('y', [('z', 'c16', (2,***REMOVED******REMOVED***,***REMOVED******REMOVED***,***REMOVED******REMOVED***,***REMOVED***
        buffer = ((([6j, 4j***REMOVED***,***REMOVED***,***REMOVED***,***REMOVED***
        h = np.array(buffer, dtype=descr***REMOVED***
        h['x'***REMOVED***['y'***REMOVED***['z'***REMOVED***

    def test_indexing2(self,level=rlevel***REMOVED***:
        # Ticket #65
        descr = [('x', 'i4', (2,***REMOVED******REMOVED******REMOVED***
        buffer = ([3, 2***REMOVED***,***REMOVED***
        h = np.array(buffer, dtype=descr***REMOVED***
        h['x'***REMOVED***

    def test_round(self,level=rlevel***REMOVED***:
        # Ticket #67
        x = np.array([1+2j***REMOVED******REMOVED***
        assert_almost_equal(x**(-1***REMOVED***, [1/(1+2j***REMOVED******REMOVED******REMOVED***

    def test_scalar_compare(self,level=rlevel***REMOVED***:
        # Trac Ticket #72
        # https://github.com/numpy/numpy/issues/565
        a = np.array(['test', 'auto'***REMOVED******REMOVED***
        assert_array_equal(a == 'auto', np.array([False, True***REMOVED******REMOVED******REMOVED***
        self.assertTrue(a[1***REMOVED*** == 'auto'***REMOVED***
        self.assertTrue(a[0***REMOVED*** != 'auto'***REMOVED***
        b = np.linspace(0, 10, 11***REMOVED***
        # This should return true for now, but will eventually raise an error:
        with warnings.catch_warnings(***REMOVED***:
            warnings.filterwarnings("ignore", category=DeprecationWarning***REMOVED***
            self.assertTrue(b != 'auto'***REMOVED***
        self.assertTrue(b[0***REMOVED*** != 'auto'***REMOVED***

    def test_unicode_swapping(self,level=rlevel***REMOVED***:
        # Ticket #79
        ulen = 1
        ucs_value = sixu('\U0010FFFF'***REMOVED***
        ua = np.array([[[ucs_value*ulen***REMOVED****2***REMOVED****3***REMOVED****4, dtype='U%s' % ulen***REMOVED***
        ua.newbyteorder(***REMOVED***  # Should succeed.

    def test_object_array_fill(self,level=rlevel***REMOVED***:
        # Ticket #86
        x = np.zeros(1, 'O'***REMOVED***
        x.fill([***REMOVED******REMOVED***

    def test_mem_dtype_align(self,level=rlevel***REMOVED***:
        # Ticket #93
        self.assertRaises(TypeError, np.dtype,
                          ***REMOVED***'names':['a'***REMOVED***,'formats':['foo'***REMOVED******REMOVED***, align=1***REMOVED***

    @dec.knownfailureif((sys.version_info[0***REMOVED*** >= 3***REMOVED*** or
                        (sys.platform == "win32" and
                         platform.architecture(***REMOVED***[0***REMOVED*** == "64bit"***REMOVED***,
                        "numpy.intp('0xff', 16***REMOVED*** not supported on Py3, "
                        "as it does not inherit from Python int"***REMOVED***
    def test_intp(self,level=rlevel***REMOVED***:
        # Ticket #99
        i_width = np.int_(0***REMOVED***.nbytes*2 - 1
        np.intp('0x' + 'f'*i_width, 16***REMOVED***
        self.assertRaises(OverflowError, np.intp, '0x' + 'f'*(i_width+1***REMOVED***, 16***REMOVED***
        self.assertRaises(ValueError, np.intp, '0x1', 32***REMOVED***
        assert_equal(255, np.intp('0xFF', 16***REMOVED******REMOVED***
        assert_equal(1024, np.intp(1024***REMOVED******REMOVED***

    def test_endian_bool_indexing(self,level=rlevel***REMOVED***:
        # Ticket #105
        a = np.arange(10., dtype='>f8'***REMOVED***
        b = np.arange(10., dtype='<f8'***REMOVED***
        xa = np.where((a > 2***REMOVED*** & (a < 6***REMOVED******REMOVED***
        xb = np.where((b > 2***REMOVED*** & (b < 6***REMOVED******REMOVED***
        ya = ((a > 2***REMOVED*** & (a < 6***REMOVED******REMOVED***
        yb = ((b > 2***REMOVED*** & (b < 6***REMOVED******REMOVED***
        assert_array_almost_equal(xa, ya.nonzero(***REMOVED******REMOVED***
        assert_array_almost_equal(xb, yb.nonzero(***REMOVED******REMOVED***
        assert_(np.all(a[ya***REMOVED*** > 0.5***REMOVED******REMOVED***
        assert_(np.all(b[yb***REMOVED*** > 0.5***REMOVED******REMOVED***

    def test_endian_where(self,level=rlevel***REMOVED***:
        # GitHub issue #369
        net = np.zeros(3, dtype='>f4'***REMOVED***
        net[1***REMOVED*** = 0.00458849
        net[2***REMOVED*** = 0.605202
        max_net = net.max(***REMOVED***
        test = np.where(net <= 0., max_net, net***REMOVED***
        correct = np.array([ 0.60520202,  0.00458849,  0.60520202***REMOVED******REMOVED***
        assert_array_almost_equal(test, correct***REMOVED***

    def test_endian_recarray(self,level=rlevel***REMOVED***:
        # Ticket #2185
        dt = np.dtype([
               ('head', '>u4'***REMOVED***,
               ('data', '>u4', 2***REMOVED***,
            ***REMOVED******REMOVED***
        buf = np.recarray(1, dtype=dt***REMOVED***
        buf[0***REMOVED***['head'***REMOVED*** = 1
        buf[0***REMOVED***['data'***REMOVED***[:***REMOVED*** = [1, 1***REMOVED***

        h = buf[0***REMOVED***['head'***REMOVED***
        d = buf[0***REMOVED***['data'***REMOVED***[0***REMOVED***
        buf[0***REMOVED***['head'***REMOVED*** = h
        buf[0***REMOVED***['data'***REMOVED***[0***REMOVED*** = d
        assert_(buf[0***REMOVED***['head'***REMOVED*** == 1***REMOVED***

    def test_mem_dot(self,level=rlevel***REMOVED***:
        # Ticket #106
        x = np.random.randn(0, 1***REMOVED***
        y = np.random.randn(10, 1***REMOVED***
        # Dummy array to detect bad memory access:
        _z = np.ones(10***REMOVED***
        _dummy = np.empty((0, 10***REMOVED******REMOVED***
        z = np.lib.stride_tricks.as_strided(_z, _dummy.shape, _dummy.strides***REMOVED***
        np.dot(x, np.transpose(y***REMOVED***, out=z***REMOVED***
        assert_equal(_z, np.ones(10***REMOVED******REMOVED***
        # Do the same for the built-in dot:
        np.core.multiarray.dot(x, np.transpose(y***REMOVED***, out=z***REMOVED***
        assert_equal(_z, np.ones(10***REMOVED******REMOVED***

    def test_arange_endian(self,level=rlevel***REMOVED***:
        # Ticket #111
        ref = np.arange(10***REMOVED***
        x = np.arange(10, dtype='<f8'***REMOVED***
        assert_array_equal(ref, x***REMOVED***
        x = np.arange(10, dtype='>f8'***REMOVED***
        assert_array_equal(ref, x***REMOVED***

    def test_argmax(self,level=rlevel***REMOVED***:
        # Ticket #119
        a = np.random.normal(0, 1, (4, 5, 6, 7, 8***REMOVED******REMOVED***
        for i in range(a.ndim***REMOVED***:
            a.argmax(i***REMOVED***  # Should succeed

    def test_mem_divmod(self,level=rlevel***REMOVED***:
        # Ticket #126
        for i in range(10***REMOVED***:
            divmod(np.array([i***REMOVED******REMOVED***[0***REMOVED***, 10***REMOVED***

    def test_hstack_invalid_dims(self,level=rlevel***REMOVED***:
        # Ticket #128
        x = np.arange(9***REMOVED***.reshape((3, 3***REMOVED******REMOVED***
        y = np.array([0, 0, 0***REMOVED******REMOVED***
        self.assertRaises(ValueError, np.hstack, (x, y***REMOVED******REMOVED***

    def test_squeeze_type(self,level=rlevel***REMOVED***:
        # Ticket #133
        a = np.array([3***REMOVED******REMOVED***
        b = np.array(3***REMOVED***
        assert_(type(a.squeeze(***REMOVED******REMOVED*** is np.ndarray***REMOVED***
        assert_(type(b.squeeze(***REMOVED******REMOVED*** is np.ndarray***REMOVED***

    def test_add_identity(self,level=rlevel***REMOVED***:
        # Ticket #143
        assert_equal(0, np.add.identity***REMOVED***

    def test_numpy_float_python_long_addition(self***REMOVED***:
        # Check that numpy float and python longs can be added correctly.
        a = np.float_(23.***REMOVED*** + 2**135
        assert_equal(a, 23. + 2**135***REMOVED***

    def test_binary_repr_0(self,level=rlevel***REMOVED***:
        # Ticket #151
        assert_equal('0', np.binary_repr(0***REMOVED******REMOVED***

    def test_rec_iterate(self,level=rlevel***REMOVED***:
        # Ticket #160
        descr = np.dtype([('i', int***REMOVED***, ('f', float***REMOVED***, ('s', '|S3'***REMOVED******REMOVED******REMOVED***
        x = np.rec.array([(1, 1.1, '1.0'***REMOVED***,
                         (2, 2.2, '2.0'***REMOVED******REMOVED***, dtype=descr***REMOVED***
        x[0***REMOVED***.tolist(***REMOVED***
        [i for i in x[0***REMOVED******REMOVED***

    def test_unicode_string_comparison(self,level=rlevel***REMOVED***:
        # Ticket #190
        a = np.array('hello', np.unicode_***REMOVED***
        b = np.array('world'***REMOVED***
        a == b

    def test_tobytes_FORTRANORDER_discontiguous(self,level=rlevel***REMOVED***:
        # Fix in r2836
        # Create non-contiguous Fortran ordered array
        x = np.array(np.random.rand(3, 3***REMOVED***, order='F'***REMOVED***[:, :2***REMOVED***
        assert_array_almost_equal(x.ravel(***REMOVED***, np.fromstring(x.tobytes(***REMOVED******REMOVED******REMOVED***

    def test_flat_assignment(self,level=rlevel***REMOVED***:
        # Correct behaviour of ticket #194
        x = np.empty((3, 1***REMOVED******REMOVED***
        x.flat = np.arange(3***REMOVED***
        assert_array_almost_equal(x, [[0***REMOVED***, [1***REMOVED***, [2***REMOVED******REMOVED******REMOVED***
        x.flat = np.arange(3, dtype=float***REMOVED***
        assert_array_almost_equal(x, [[0***REMOVED***, [1***REMOVED***, [2***REMOVED******REMOVED******REMOVED***

    def test_broadcast_flat_assignment(self,level=rlevel***REMOVED***:
        # Ticket #194
        x = np.empty((3, 1***REMOVED******REMOVED***

        def bfa(***REMOVED***:
            x[:***REMOVED*** = np.arange(3***REMOVED***

        def bfb(***REMOVED***:
            x[:***REMOVED*** = np.arange(3, dtype=float***REMOVED***

        self.assertRaises(ValueError, bfa***REMOVED***
        self.assertRaises(ValueError, bfb***REMOVED***

    def test_nonarray_assignment(self***REMOVED***:
        # See also Issue gh-2870, test for non-array assignment
        # and equivalent unsafe casted array assignment
        a = np.arange(10***REMOVED***
        b = np.ones(10, dtype=bool***REMOVED***
        r = np.arange(10***REMOVED***

        def assign(a, b, c***REMOVED***:
            a[b***REMOVED*** = c

        assert_raises(ValueError, assign, a, b, np.nan***REMOVED***
        a[b***REMOVED*** = np.array(np.nan***REMOVED***  # but not this.
        assert_raises(ValueError, assign, a, r, np.nan***REMOVED***
        a[r***REMOVED*** = np.array(np.nan***REMOVED***

    def test_unpickle_dtype_with_object(self,level=rlevel***REMOVED***:
        # Implemented in r2840
        dt = np.dtype([('x', int***REMOVED***, ('y', np.object_***REMOVED***, ('z', 'O'***REMOVED******REMOVED******REMOVED***
        f = BytesIO(***REMOVED***
        pickle.dump(dt, f***REMOVED***
        f.seek(0***REMOVED***
        dt_ = pickle.load(f***REMOVED***
        f.close(***REMOVED***
        assert_equal(dt, dt_***REMOVED***

    def test_mem_array_creation_invalid_specification(self,level=rlevel***REMOVED***:
        # Ticket #196
        dt = np.dtype([('x', int***REMOVED***, ('y', np.object_***REMOVED******REMOVED******REMOVED***
        # Wrong way
        self.assertRaises(ValueError, np.array, [1, 'object'***REMOVED***, dt***REMOVED***
        # Correct way
        np.array([(1, 'object'***REMOVED******REMOVED***, dt***REMOVED***

    def test_recarray_single_element(self,level=rlevel***REMOVED***:
        # Ticket #202
        a = np.array([1, 2, 3***REMOVED***, dtype=np.int32***REMOVED***
        b = a.copy(***REMOVED***
        r = np.rec.array(a, shape=1, formats=['3i4'***REMOVED***, names=['d'***REMOVED******REMOVED***
        assert_array_equal(a, b***REMOVED***
        assert_equal(a, r[0***REMOVED***[0***REMOVED******REMOVED***

    def test_zero_sized_array_indexing(self,level=rlevel***REMOVED***:
        # Ticket #205
        tmp = np.array([***REMOVED******REMOVED***

        def index_tmp(***REMOVED***:
            tmp[np.array(10***REMOVED******REMOVED***

        self.assertRaises(IndexError, index_tmp***REMOVED***

    def test_chararray_rstrip(self,level=rlevel***REMOVED***:
        # Ticket #222
        x = np.chararray((1,***REMOVED***, 5***REMOVED***
        x[0***REMOVED*** = asbytes('a   '***REMOVED***
        x = x.rstrip(***REMOVED***
        assert_equal(x[0***REMOVED***, asbytes('a'***REMOVED******REMOVED***

    def test_object_array_shape(self,level=rlevel***REMOVED***:
        # Ticket #239
        assert_equal(np.array([[1, 2***REMOVED***, 3, 4***REMOVED***, dtype=object***REMOVED***.shape, (3,***REMOVED******REMOVED***
        assert_equal(np.array([[1, 2***REMOVED***, [3, 4***REMOVED******REMOVED***, dtype=object***REMOVED***.shape, (2, 2***REMOVED******REMOVED***
        assert_equal(np.array([(1, 2***REMOVED***, (3, 4***REMOVED******REMOVED***, dtype=object***REMOVED***.shape, (2, 2***REMOVED******REMOVED***
        assert_equal(np.array([***REMOVED***, dtype=object***REMOVED***.shape, (0,***REMOVED******REMOVED***
        assert_equal(np.array([[***REMOVED***, [***REMOVED***, [***REMOVED******REMOVED***, dtype=object***REMOVED***.shape, (3, 0***REMOVED******REMOVED***
        assert_equal(np.array([[3, 4***REMOVED***, [5, 6***REMOVED***, None***REMOVED***, dtype=object***REMOVED***.shape, (3,***REMOVED******REMOVED***

    def test_mem_around(self,level=rlevel***REMOVED***:
        # Ticket #243
        x = np.zeros((1,***REMOVED******REMOVED***
        y = [0***REMOVED***
        decimal = 6
        np.around(abs(x-y***REMOVED***, decimal***REMOVED*** <= 10.0**(-decimal***REMOVED***

    def test_character_array_strip(self,level=rlevel***REMOVED***:
        # Ticket #246
        x = np.char.array(("x", "x ", "x  "***REMOVED******REMOVED***
        for c in x:
            assert_equal(c, "x"***REMOVED***

    def test_lexsort(self,level=rlevel***REMOVED***:
        # Lexsort memory error
        v = np.array([1, 2, 3, 4, 5, 6, 7, 8, 9, 10***REMOVED******REMOVED***
        assert_equal(np.lexsort(v***REMOVED***, 0***REMOVED***

    def test_lexsort_invalid_sequence(self***REMOVED***:
        # Issue gh-4123
        class BuggySequence(object***REMOVED***:
            def __len__(self***REMOVED***:
                return 4

            def __getitem__(self, key***REMOVED***:
                raise KeyError

        assert_raises(KeyError, np.lexsort, BuggySequence(***REMOVED******REMOVED***

    def test_pickle_py2_bytes_encoding(self***REMOVED***:
        # Check that arrays and scalars pickled on Py2 are
        # unpickleable on Py3 using encoding='bytes'

        test_data = [
            # (original, py2_pickle***REMOVED***
            (np.unicode_('\u6f2c'***REMOVED***,
             asbytes("cnumpy.core.multiarray\nscalar\np0\n(cnumpy\ndtype\np1\n"
                     "(S'U1'\np2\nI0\nI1\ntp3\nRp4\n(I3\nS'<'\np5\nNNNI4\nI4\n"
                     "I0\ntp6\nbS',o\\x00\\x00'\np7\ntp8\nRp9\n."***REMOVED******REMOVED***,

            (np.array([9e123***REMOVED***, dtype=np.float64***REMOVED***,
             asbytes("cnumpy.core.multiarray\n_reconstruct\np0\n(cnumpy\nndarray\n"
                     "p1\n(I0\ntp2\nS'b'\np3\ntp4\nRp5\n(I1\n(I1\ntp6\ncnumpy\ndtype\n"
                     "p7\n(S'f8'\np8\nI0\nI1\ntp9\nRp10\n(I3\nS'<'\np11\nNNNI-1\nI-1\n"
                     "I0\ntp12\nbI00\nS'O\\x81\\xb7Z\\xaa:\\xabY'\np13\ntp14\nb."***REMOVED******REMOVED***,

            (np.array([(9e123,***REMOVED******REMOVED***, dtype=[('name', float***REMOVED******REMOVED******REMOVED***,
             asbytes("cnumpy.core.multiarray\n_reconstruct\np0\n(cnumpy\nndarray\np1\n"
                     "(I0\ntp2\nS'b'\np3\ntp4\nRp5\n(I1\n(I1\ntp6\ncnumpy\ndtype\np7\n"
                     "(S'V8'\np8\nI0\nI1\ntp9\nRp10\n(I3\nS'|'\np11\nN(S'name'\np12\ntp13\n"
                     "(dp14\ng12\n(g7\n(S'f8'\np15\nI0\nI1\ntp16\nRp17\n(I3\nS'<'\np18\nNNNI-1\n"
                     "I-1\nI0\ntp19\nbI0\ntp20\nsI8\nI1\nI0\ntp21\n"
                     "bI00\nS'O\\x81\\xb7Z\\xaa:\\xabY'\np22\ntp23\nb."***REMOVED******REMOVED***,
        ***REMOVED***

        if sys.version_info[:2***REMOVED*** >= (3, 4***REMOVED***:
            # encoding='bytes' was added in Py3.4
            for original, data in test_data:
                result = pickle.loads(data, encoding='bytes'***REMOVED***
                assert_equal(result, original***REMOVED***

                if isinstance(result, np.ndarray***REMOVED*** and result.dtype.names:
                    for name in result.dtype.names:
                        assert_(isinstance(name, str***REMOVED******REMOVED***

    def test_pickle_dtype(self,level=rlevel***REMOVED***:
        # Ticket #251
        pickle.dumps(np.float***REMOVED***

    def test_swap_real(self, level=rlevel***REMOVED***:
        # Ticket #265
        assert_equal(np.arange(4, dtype='>c8'***REMOVED***.imag.max(***REMOVED***, 0.0***REMOVED***
        assert_equal(np.arange(4, dtype='<c8'***REMOVED***.imag.max(***REMOVED***, 0.0***REMOVED***
        assert_equal(np.arange(4, dtype='>c8'***REMOVED***.real.max(***REMOVED***, 3.0***REMOVED***
        assert_equal(np.arange(4, dtype='<c8'***REMOVED***.real.max(***REMOVED***, 3.0***REMOVED***

    def test_object_array_from_list(self, level=rlevel***REMOVED***:
        # Ticket #270
        np.array([1, 'A', None***REMOVED******REMOVED***  # Should succeed

    def test_multiple_assign(self, level=rlevel***REMOVED***:
        # Ticket #273
        a = np.zeros((3, 1***REMOVED***, int***REMOVED***
        a[[1, 2***REMOVED******REMOVED*** = 1

    def test_empty_array_type(self, level=rlevel***REMOVED***:
        assert_equal(np.array([***REMOVED******REMOVED***.dtype, np.zeros(0***REMOVED***.dtype***REMOVED***

    def test_void_copyswap(self, level=rlevel***REMOVED***:
        dt = np.dtype([('one', '<i4'***REMOVED***, ('two', '<i4'***REMOVED******REMOVED******REMOVED***
        x = np.array((1, 2***REMOVED***, dtype=dt***REMOVED***
        x = x.byteswap(***REMOVED***
        assert_(x['one'***REMOVED*** > 1 and x['two'***REMOVED*** > 2***REMOVED***

    def test_method_args(self, level=rlevel***REMOVED***:
        # Make sure methods and functions have same default axis
        # keyword and arguments
        funcs1 = ['argmax', 'argmin', 'sum', ('product', 'prod'***REMOVED***,
                 ('sometrue', 'any'***REMOVED***,
                 ('alltrue', 'all'***REMOVED***, 'cumsum', ('cumproduct', 'cumprod'***REMOVED***,
                 'ptp', 'cumprod', 'prod', 'std', 'var', 'mean',
                 'round', 'min', 'max', 'argsort', 'sort'***REMOVED***
        funcs2 = ['compress', 'take', 'repeat'***REMOVED***

        for func in funcs1:
            arr = np.random.rand(8, 7***REMOVED***
            arr2 = arr.copy(***REMOVED***
            if isinstance(func, tuple***REMOVED***:
                func_meth = func[1***REMOVED***
                func = func[0***REMOVED***
            else:
                func_meth = func
            res1 = getattr(arr, func_meth***REMOVED***(***REMOVED***
            res2 = getattr(np, func***REMOVED***(arr2***REMOVED***
            if res1 is None:
                res1 = arr

            if res1.dtype.kind in 'uib':
                assert_((res1 == res2***REMOVED***.all(***REMOVED***, func***REMOVED***
            else:
                assert_(abs(res1-res2***REMOVED***.max(***REMOVED*** < 1e-8, func***REMOVED***

        for func in funcs2:
            arr1 = np.random.rand(8, 7***REMOVED***
            arr2 = np.random.rand(8, 7***REMOVED***
            res1 = None
            if func == 'compress':
                arr1 = arr1.ravel(***REMOVED***
                res1 = getattr(arr2, func***REMOVED***(arr1***REMOVED***
            else:
                arr2 = (15*arr2***REMOVED***.astype(int***REMOVED***.ravel(***REMOVED***
            if res1 is None:
                res1 = getattr(arr1, func***REMOVED***(arr2***REMOVED***
            res2 = getattr(np, func***REMOVED***(arr1, arr2***REMOVED***
            assert_(abs(res1-res2***REMOVED***.max(***REMOVED*** < 1e-8, func***REMOVED***

    def test_mem_lexsort_strings(self, level=rlevel***REMOVED***:
        # Ticket #298
        lst = ['abc', 'cde', 'fgh'***REMOVED***
        np.lexsort((lst,***REMOVED******REMOVED***

    def test_fancy_index(self, level=rlevel***REMOVED***:
        # Ticket #302
        x = np.array([1, 2***REMOVED******REMOVED***[np.array([0***REMOVED******REMOVED******REMOVED***
        assert_equal(x.shape, (1,***REMOVED******REMOVED***

    def test_recarray_copy(self, level=rlevel***REMOVED***:
        # Ticket #312
        dt = [('x', np.int16***REMOVED***, ('y', np.float64***REMOVED******REMOVED***
        ra = np.array([(1, 2.3***REMOVED******REMOVED***, dtype=dt***REMOVED***
        rb = np.rec.array(ra, dtype=dt***REMOVED***
        rb['x'***REMOVED*** = 2.
        assert_(ra['x'***REMOVED*** != rb['x'***REMOVED******REMOVED***

    def test_rec_fromarray(self, level=rlevel***REMOVED***:
        # Ticket #322
        x1 = np.array([[1, 2***REMOVED***, [3, 4***REMOVED***, [5, 6***REMOVED******REMOVED******REMOVED***
        x2 = np.array(['a', 'dd', 'xyz'***REMOVED******REMOVED***
        x3 = np.array([1.1, 2, 3***REMOVED******REMOVED***
        np.rec.fromarrays([x1, x2, x3***REMOVED***, formats="(2,***REMOVED***i4,a3,f8"***REMOVED***

    def test_object_array_assign(self, level=rlevel***REMOVED***:
        x = np.empty((2, 2***REMOVED***, object***REMOVED***
        x.flat[2***REMOVED*** = (1, 2, 3***REMOVED***
        assert_equal(x.flat[2***REMOVED***, (1, 2, 3***REMOVED******REMOVED***

    def test_ndmin_float64(self, level=rlevel***REMOVED***:
        # Ticket #324
        x = np.array([1, 2, 3***REMOVED***, dtype=np.float64***REMOVED***
        assert_equal(np.array(x, dtype=np.float32, ndmin=2***REMOVED***.ndim, 2***REMOVED***
        assert_equal(np.array(x, dtype=np.float64, ndmin=2***REMOVED***.ndim, 2***REMOVED***

    def test_ndmin_order(self, level=rlevel***REMOVED***:
        # Issue #465 and related checks
        assert_(np.array([1, 2***REMOVED***, order='C', ndmin=3***REMOVED***.flags.c_contiguous***REMOVED***
        assert_(np.array([1, 2***REMOVED***, order='F', ndmin=3***REMOVED***.flags.f_contiguous***REMOVED***
        assert_(np.array(np.ones((2, 2***REMOVED***, order='F'***REMOVED***, ndmin=3***REMOVED***.flags.f_contiguous***REMOVED***
        assert_(np.array(np.ones((2, 2***REMOVED***, order='C'***REMOVED***, ndmin=3***REMOVED***.flags.c_contiguous***REMOVED***

    def test_mem_axis_minimization(self, level=rlevel***REMOVED***:
        # Ticket #327
        data = np.arange(5***REMOVED***
        data = np.add.outer(data, data***REMOVED***

    def test_mem_float_imag(self, level=rlevel***REMOVED***:
        # Ticket #330
        np.float64(1.0***REMOVED***.imag

    def test_dtype_tuple(self, level=rlevel***REMOVED***:
        # Ticket #334
        assert_(np.dtype('i4'***REMOVED*** == np.dtype(('i4', (***REMOVED******REMOVED******REMOVED******REMOVED***

    def test_dtype_posttuple(self, level=rlevel***REMOVED***:
        # Ticket #335
        np.dtype([('col1', '(***REMOVED***i4'***REMOVED******REMOVED******REMOVED***

    def test_numeric_carray_compare(self, level=rlevel***REMOVED***:
        # Ticket #341
        assert_equal(np.array(['X'***REMOVED***, 'c'***REMOVED***, asbytes('X'***REMOVED******REMOVED***

    def test_string_array_size(self, level=rlevel***REMOVED***:
        # Ticket #342
        self.assertRaises(ValueError,
                              np.array, [['X'***REMOVED***, ['X', 'X', 'X'***REMOVED******REMOVED***, '|S1'***REMOVED***

    def test_dtype_repr(self, level=rlevel***REMOVED***:
        # Ticket #344
        dt1 = np.dtype(('uint32', 2***REMOVED******REMOVED***
        dt2 = np.dtype(('uint32', (2,***REMOVED******REMOVED******REMOVED***
        assert_equal(dt1.__repr__(***REMOVED***, dt2.__repr__(***REMOVED******REMOVED***

    def test_reshape_order(self, level=rlevel***REMOVED***:
        # Make sure reshape order works.
        a = np.arange(6***REMOVED***.reshape(2, 3, order='F'***REMOVED***
        assert_equal(a, [[0, 2, 4***REMOVED***, [1, 3, 5***REMOVED******REMOVED******REMOVED***
        a = np.array([[1, 2***REMOVED***, [3, 4***REMOVED***, [5, 6***REMOVED***, [7, 8***REMOVED******REMOVED******REMOVED***
        b = a[:, 1***REMOVED***
        assert_equal(b.reshape(2, 2, order='F'***REMOVED***, [[2, 6***REMOVED***, [4, 8***REMOVED******REMOVED******REMOVED***

    def test_reshape_zero_strides(self, level=rlevel***REMOVED***:
        # Issue #380, test reshaping of zero strided arrays
        a = np.ones(1***REMOVED***
        a = np.lib.stride_tricks.as_strided(a, shape=(5,***REMOVED***, strides=(0,***REMOVED******REMOVED***
        assert_(a.reshape(5, 1***REMOVED***.strides[0***REMOVED*** == 0***REMOVED***

    def test_reshape_zero_size(self, level=rlevel***REMOVED***:
        # GitHub Issue #2700, setting shape failed for 0-sized arrays
        a = np.ones((0, 2***REMOVED******REMOVED***
        a.shape = (-1, 2***REMOVED***

    # Cannot test if NPY_RELAXED_STRIDES_CHECKING changes the strides.
    # With NPY_RELAXED_STRIDES_CHECKING the test becomes superfluous.
    @dec.skipif(np.ones(1***REMOVED***.strides[0***REMOVED*** == np.iinfo(np.intp***REMOVED***.max***REMOVED***
    def test_reshape_trailing_ones_strides(self***REMOVED***:
        # GitHub issue gh-2949, bad strides for trailing ones of new shape
        a = np.zeros(12, dtype=np.int32***REMOVED***[::2***REMOVED***  # not contiguous
        strides_c = (16, 8, 8, 8***REMOVED***
        strides_f = (8, 24, 48, 48***REMOVED***
        assert_equal(a.reshape(3, 2, 1, 1***REMOVED***.strides, strides_c***REMOVED***
        assert_equal(a.reshape(3, 2, 1, 1, order='F'***REMOVED***.strides, strides_f***REMOVED***
        assert_equal(np.array(0, dtype=np.int32***REMOVED***.reshape(1, 1***REMOVED***.strides, (4, 4***REMOVED******REMOVED***

    def test_repeat_discont(self, level=rlevel***REMOVED***:
        # Ticket #352
        a = np.arange(12***REMOVED***.reshape(4, 3***REMOVED***[:, 2***REMOVED***
        assert_equal(a.repeat(3***REMOVED***, [2, 2, 2, 5, 5, 5, 8, 8, 8, 11, 11, 11***REMOVED******REMOVED***

    def test_array_index(self, level=rlevel***REMOVED***:
        # Make sure optimization is not called in this case.
        a = np.array([1, 2, 3***REMOVED******REMOVED***
        a2 = np.array([[1, 2, 3***REMOVED******REMOVED******REMOVED***
        assert_equal(a[np.where(a == 3***REMOVED******REMOVED***, a2[np.where(a2 == 3***REMOVED******REMOVED******REMOVED***

    def test_object_argmax(self, level=rlevel***REMOVED***:
        a = np.array([1, 2, 3***REMOVED***, dtype=object***REMOVED***
        assert_(a.argmax(***REMOVED*** == 2***REMOVED***

    def test_recarray_fields(self, level=rlevel***REMOVED***:
        # Ticket #372
        dt0 = np.dtype([('f0', 'i4'***REMOVED***, ('f1', 'i4'***REMOVED******REMOVED******REMOVED***
        dt1 = np.dtype([('f0', 'i8'***REMOVED***, ('f1', 'i8'***REMOVED******REMOVED******REMOVED***
        for a in [np.array([(1, 2***REMOVED***, (3, 4***REMOVED******REMOVED***, "i4,i4"***REMOVED***,
                  np.rec.array([(1, 2***REMOVED***, (3, 4***REMOVED******REMOVED***, "i4,i4"***REMOVED***,
                  np.rec.array([(1, 2***REMOVED***, (3, 4***REMOVED******REMOVED******REMOVED***,
                  np.rec.fromarrays([(1, 2***REMOVED***, (3, 4***REMOVED******REMOVED***, "i4,i4"***REMOVED***,
                  np.rec.fromarrays([(1, 2***REMOVED***, (3, 4***REMOVED******REMOVED******REMOVED******REMOVED***:
            assert_(a.dtype in [dt0, dt1***REMOVED******REMOVED***

    def test_random_shuffle(self, level=rlevel***REMOVED***:
        # Ticket #374
        a = np.arange(5***REMOVED***.reshape((5, 1***REMOVED******REMOVED***
        b = a.copy(***REMOVED***
        np.random.shuffle(b***REMOVED***
        assert_equal(np.sort(b, axis=0***REMOVED***, a***REMOVED***

    def test_refcount_vdot(self, level=rlevel***REMOVED***:
        # Changeset #3443
        _assert_valid_refcount(np.vdot***REMOVED***

    def test_startswith(self, level=rlevel***REMOVED***:
        ca = np.char.array(['Hi', 'There'***REMOVED******REMOVED***
        assert_equal(ca.startswith('H'***REMOVED***, [True, False***REMOVED******REMOVED***

    def test_noncommutative_reduce_accumulate(self, level=rlevel***REMOVED***:
        # Ticket #413
        tosubtract = np.arange(5***REMOVED***
        todivide = np.array([2.0, 0.5, 0.25***REMOVED******REMOVED***
        assert_equal(np.subtract.reduce(tosubtract***REMOVED***, -10***REMOVED***
        assert_equal(np.divide.reduce(todivide***REMOVED***, 16.0***REMOVED***
        assert_array_equal(np.subtract.accumulate(tosubtract***REMOVED***,
            np.array([0, -1, -3, -6, -10***REMOVED******REMOVED******REMOVED***
        assert_array_equal(np.divide.accumulate(todivide***REMOVED***,
            np.array([2., 4., 16.***REMOVED******REMOVED******REMOVED***

    def test_convolve_empty(self, level=rlevel***REMOVED***:
        # Convolve should raise an error for empty input array.
        self.assertRaises(ValueError, np.convolve, [***REMOVED***, [1***REMOVED******REMOVED***
        self.assertRaises(ValueError, np.convolve, [1***REMOVED***, [***REMOVED******REMOVED***

    def test_multidim_byteswap(self, level=rlevel***REMOVED***:
        # Ticket #449
        r = np.array([(1, (0, 1, 2***REMOVED******REMOVED******REMOVED***, dtype="i2,3i2"***REMOVED***
        assert_array_equal(r.byteswap(***REMOVED***,
                           np.array([(256, (0, 256, 512***REMOVED******REMOVED******REMOVED***, r.dtype***REMOVED******REMOVED***

    def test_string_NULL(self, level=rlevel***REMOVED***:
        # Changeset 3557
        assert_equal(np.array("a\x00\x0b\x0c\x00"***REMOVED***.item(***REMOVED***,
                     'a\x00\x0b\x0c'***REMOVED***

    def test_junk_in_string_fields_of_recarray(self, level=rlevel***REMOVED***:
        # Ticket #483
        r = np.array([[asbytes('abc'***REMOVED******REMOVED******REMOVED***, dtype=[('var1', '|S20'***REMOVED******REMOVED******REMOVED***
        assert_(asbytes(r['var1'***REMOVED***[0***REMOVED***[0***REMOVED******REMOVED*** == asbytes('abc'***REMOVED******REMOVED***

    def test_take_output(self, level=rlevel***REMOVED***:
        # Ensure that 'take' honours output parameter.
        x = np.arange(12***REMOVED***.reshape((3, 4***REMOVED******REMOVED***
        a = np.take(x, [0, 2***REMOVED***, axis=1***REMOVED***
        b = np.zeros_like(a***REMOVED***
        np.take(x, [0, 2***REMOVED***, axis=1, out=b***REMOVED***
        assert_array_equal(a, b***REMOVED***

    def test_take_object_fail(self***REMOVED***:
        # Issue gh-3001
        d = 123.
        a = np.array([d, 1***REMOVED***, dtype=object***REMOVED***
        ref_d = sys.getrefcount(d***REMOVED***
        ***REMOVED***
            a.take([0, 100***REMOVED******REMOVED***
        except IndexError:
            pass
        assert_(ref_d == sys.getrefcount(d***REMOVED******REMOVED***

    def test_array_str_64bit(self, level=rlevel***REMOVED***:
        # Ticket #501
        s = np.array([1, np.nan***REMOVED***, dtype=np.float64***REMOVED***
        with np.errstate(all='raise'***REMOVED***:
            np.array_str(s***REMOVED***  # Should succeed

    def test_frompyfunc_endian(self, level=rlevel***REMOVED***:
        # Ticket #503
        from math import radians
        uradians = np.frompyfunc(radians, 1, 1***REMOVED***
        big_endian = np.array([83.4, 83.5***REMOVED***, dtype='>f8'***REMOVED***
        little_endian = np.array([83.4, 83.5***REMOVED***, dtype='<f8'***REMOVED***
        assert_almost_equal(uradians(big_endian***REMOVED***.astype(float***REMOVED***,
                            uradians(little_endian***REMOVED***.astype(float***REMOVED******REMOVED***

    def test_mem_string_arr(self, level=rlevel***REMOVED***:
        # Ticket #514
        s = "aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"
        t = [***REMOVED***
        np.hstack((t, s***REMOVED******REMOVED***

    def test_arr_transpose(self, level=rlevel***REMOVED***:
        # Ticket #516
        x = np.random.rand(*(2,***REMOVED****16***REMOVED***
        x.transpose(list(range(16***REMOVED******REMOVED******REMOVED***  # Should succeed

    def test_string_mergesort(self, level=rlevel***REMOVED***:
        # Ticket #540
        x = np.array(['a'***REMOVED****32***REMOVED***
        assert_array_equal(x.argsort(kind='m'***REMOVED***, np.arange(32***REMOVED******REMOVED***

    def test_argmax_byteorder(self, level=rlevel***REMOVED***:
        # Ticket #546
        a = np.arange(3, dtype='>f'***REMOVED***
        assert_(a[a.argmax(***REMOVED******REMOVED*** == a.max(***REMOVED******REMOVED***

    def test_rand_seed(self, level=rlevel***REMOVED***:
        # Ticket #555
        for l in np.arange(4***REMOVED***:
            np.random.seed(l***REMOVED***

    def test_mem_deallocation_leak(self, level=rlevel***REMOVED***:
        # Ticket #562
        a = np.zeros(5, dtype=float***REMOVED***
        b = np.array(a, dtype=float***REMOVED***
        del a, b

    def test_mem_on_invalid_dtype(self***REMOVED***:
        "Ticket #583"
        self.assertRaises(ValueError, np.fromiter, [['12', ''***REMOVED***, ['13', ''***REMOVED******REMOVED***, str***REMOVED***

    def test_dot_negative_stride(self, level=rlevel***REMOVED***:
        # Ticket #588
        x = np.array([[1, 5, 25, 125., 625***REMOVED******REMOVED******REMOVED***
        y = np.array([[20.***REMOVED***, [160.***REMOVED***, [640.***REMOVED***, [1280.***REMOVED***, [1024.***REMOVED******REMOVED******REMOVED***
        z = y[::-1***REMOVED***.copy(***REMOVED***
        y2 = y[::-1***REMOVED***
        assert_equal(np.dot(x, z***REMOVED***, np.dot(x, y2***REMOVED******REMOVED***

    def test_object_casting(self, level=rlevel***REMOVED***:
        # This used to trigger the object-type version of
        # the bitwise_or operation, because float64 -> object
        # casting succeeds
        def rs(***REMOVED***:
            x = np.ones([484, 286***REMOVED******REMOVED***
            y = np.zeros([484, 286***REMOVED******REMOVED***
            x |= y

        self.assertRaises(TypeError, rs***REMOVED***

    def test_unicode_scalar(self, level=rlevel***REMOVED***:
        # Ticket #600
        x = np.array(["DROND", "DROND1"***REMOVED***, dtype="U6"***REMOVED***
        el = x[1***REMOVED***
        new = pickle.loads(pickle.dumps(el***REMOVED******REMOVED***
        assert_equal(new, el***REMOVED***

    def test_arange_non_native_dtype(self, level=rlevel***REMOVED***:
        # Ticket #616
        for T in ('>f4', '<f4'***REMOVED***:
            dt = np.dtype(T***REMOVED***
            assert_equal(np.arange(0, dtype=dt***REMOVED***.dtype, dt***REMOVED***
            assert_equal(np.arange(0.5, dtype=dt***REMOVED***.dtype, dt***REMOVED***
            assert_equal(np.arange(5, dtype=dt***REMOVED***.dtype, dt***REMOVED***

    def test_bool_flat_indexing_invalid_nr_elements(self, level=rlevel***REMOVED***:
        s = np.ones(10, dtype=float***REMOVED***
        x = np.array((15,***REMOVED***, dtype=float***REMOVED***

        def ia(x, s, v***REMOVED***:
            x[(s > 0***REMOVED******REMOVED*** = v

        # After removing deprecation, the following are ValueErrors.
        # This might seem odd as compared to the value error below. This
        # is due to the fact that the new code always uses "nonzero" logic
        # and the boolean special case is not taken.
        with warnings.catch_warnings(***REMOVED***:
            warnings.simplefilter('ignore', DeprecationWarning***REMOVED***
            warnings.simplefilter('ignore', np.VisibleDeprecationWarning***REMOVED***
            self.assertRaises(IndexError, ia, x, s, np.zeros(9, dtype=float***REMOVED******REMOVED***
            self.assertRaises(IndexError, ia, x, s, np.zeros(11, dtype=float***REMOVED******REMOVED***
        # Old special case (different code path***REMOVED***:
        self.assertRaises(ValueError, ia, x.flat, s, np.zeros(9, dtype=float***REMOVED******REMOVED***
        self.assertRaises(ValueError, ia, x.flat, s, np.zeros(11, dtype=float***REMOVED******REMOVED***

    def test_mem_scalar_indexing(self, level=rlevel***REMOVED***:
        # Ticket #603
        x = np.array([0***REMOVED***, dtype=float***REMOVED***
        index = np.array(0, dtype=np.int32***REMOVED***
        x[index***REMOVED***

    def test_binary_repr_0_width(self, level=rlevel***REMOVED***:
        assert_equal(np.binary_repr(0, width=3***REMOVED***, '000'***REMOVED***

    def test_fromstring(self, level=rlevel***REMOVED***:
        assert_equal(np.fromstring("12:09:09", dtype=int, sep=":"***REMOVED***,
                     [12, 9, 9***REMOVED******REMOVED***

    def test_searchsorted_variable_length(self, level=rlevel***REMOVED***:
        x = np.array(['a', 'aa', 'b'***REMOVED******REMOVED***
        y = np.array(['d', 'e'***REMOVED******REMOVED***
        assert_equal(x.searchsorted(y***REMOVED***, [3, 3***REMOVED******REMOVED***

    def test_string_argsort_with_zeros(self, level=rlevel***REMOVED***:
        # Check argsort for strings containing zeros.
        x = np.fromstring("\x00\x02\x00\x01", dtype="|S2"***REMOVED***
        assert_array_equal(x.argsort(kind='m'***REMOVED***, np.array([1, 0***REMOVED******REMOVED******REMOVED***
        assert_array_equal(x.argsort(kind='q'***REMOVED***, np.array([1, 0***REMOVED******REMOVED******REMOVED***

    def test_string_sort_with_zeros(self, level=rlevel***REMOVED***:
        # Check sort for strings containing zeros.
        x = np.fromstring("\x00\x02\x00\x01", dtype="|S2"***REMOVED***
        y = np.fromstring("\x00\x01\x00\x02", dtype="|S2"***REMOVED***
        assert_array_equal(np.sort(x, kind="q"***REMOVED***, y***REMOVED***

    def test_copy_detection_zero_dim(self, level=rlevel***REMOVED***:
        # Ticket #658
        np.indices((0, 3, 4***REMOVED******REMOVED***.T.reshape(-1, 3***REMOVED***

    def test_flat_byteorder(self, level=rlevel***REMOVED***:
        # Ticket #657
        x = np.arange(10***REMOVED***
        assert_array_equal(x.astype('>i4'***REMOVED***, x.astype('<i4'***REMOVED***.flat[:***REMOVED******REMOVED***
        assert_array_equal(x.astype('>i4'***REMOVED***.flat[:***REMOVED***, x.astype('<i4'***REMOVED******REMOVED***

    def test_uint64_from_negative(self, level=rlevel***REMOVED***:
        assert_equal(np.uint64(-2***REMOVED***, np.uint64(18446744073709551614***REMOVED******REMOVED***

    def test_sign_bit(self, level=rlevel***REMOVED***:
        x = np.array([0, -0.0, 0***REMOVED******REMOVED***
        assert_equal(str(np.abs(x***REMOVED******REMOVED***, '[ 0.  0.  0.***REMOVED***'***REMOVED***

    def test_flat_index_byteswap(self, level=rlevel***REMOVED***:
        for dt in (np.dtype('<i4'***REMOVED***, np.dtype('>i4'***REMOVED******REMOVED***:
            x = np.array([-1, 0, 1***REMOVED***, dtype=dt***REMOVED***
            assert_equal(x.flat[0***REMOVED***.dtype, x[0***REMOVED***.dtype***REMOVED***

    def test_copy_detection_corner_case(self, level=rlevel***REMOVED***:
        # Ticket #658
        np.indices((0, 3, 4***REMOVED******REMOVED***.T.reshape(-1, 3***REMOVED***

    # Cannot test if NPY_RELAXED_STRIDES_CHECKING changes the strides.
    # With NPY_RELAXED_STRIDES_CHECKING the test becomes superfluous,
    # 0-sized reshape itself is tested elsewhere.
    @dec.skipif(np.ones(1***REMOVED***.strides[0***REMOVED*** == np.iinfo(np.intp***REMOVED***.max***REMOVED***
    def test_copy_detection_corner_case2(self, level=rlevel***REMOVED***:
        # Ticket #771: strides are not set correctly when reshaping 0-sized
        # arrays
        b = np.indices((0, 3, 4***REMOVED******REMOVED***.T.reshape(-1, 3***REMOVED***
        assert_equal(b.strides, (3 * b.itemsize, b.itemsize***REMOVED******REMOVED***

    def test_object_array_refcounting(self, level=rlevel***REMOVED***:
        # Ticket #633
        if not hasattr(sys, 'getrefcount'***REMOVED***:
            return

        # NB. this is probably CPython-specific

        cnt = sys.getrefcount

        a = object(***REMOVED***
        b = object(***REMOVED***
        c = object(***REMOVED***

        cnt0_a = cnt(a***REMOVED***
        cnt0_b = cnt(b***REMOVED***
        cnt0_c = cnt(c***REMOVED***

        # -- 0d -> 1-d broadcast slice assignment

        arr = np.zeros(5, dtype=np.object_***REMOVED***

        arr[:***REMOVED*** = a
        assert_equal(cnt(a***REMOVED***, cnt0_a + 5***REMOVED***

        arr[:***REMOVED*** = b
        assert_equal(cnt(a***REMOVED***, cnt0_a***REMOVED***
        assert_equal(cnt(b***REMOVED***, cnt0_b + 5***REMOVED***

        arr[:2***REMOVED*** = c
        assert_equal(cnt(b***REMOVED***, cnt0_b + 3***REMOVED***
        assert_equal(cnt(c***REMOVED***, cnt0_c + 2***REMOVED***

        del arr

        # -- 1-d -> 2-d broadcast slice assignment

        arr = np.zeros((5, 2***REMOVED***, dtype=np.object_***REMOVED***
        arr0 = np.zeros(2, dtype=np.object_***REMOVED***

        arr0[0***REMOVED*** = a
        assert_(cnt(a***REMOVED*** == cnt0_a + 1***REMOVED***
        arr0[1***REMOVED*** = b
        assert_(cnt(b***REMOVED*** == cnt0_b + 1***REMOVED***

        arr[:,:***REMOVED*** = arr0
        assert_(cnt(a***REMOVED*** == cnt0_a + 6***REMOVED***
        assert_(cnt(b***REMOVED*** == cnt0_b + 6***REMOVED***

        arr[:, 0***REMOVED*** = None
        assert_(cnt(a***REMOVED*** == cnt0_a + 1***REMOVED***

        del arr, arr0

        # -- 2-d copying + flattening

        arr = np.zeros((5, 2***REMOVED***, dtype=np.object_***REMOVED***

        arr[:, 0***REMOVED*** = a
        arr[:, 1***REMOVED*** = b
        assert_(cnt(a***REMOVED*** == cnt0_a + 5***REMOVED***
        assert_(cnt(b***REMOVED*** == cnt0_b + 5***REMOVED***

        arr2 = arr.copy(***REMOVED***
        assert_(cnt(a***REMOVED*** == cnt0_a + 10***REMOVED***
        assert_(cnt(b***REMOVED*** == cnt0_b + 10***REMOVED***

        arr2 = arr[:, 0***REMOVED***.copy(***REMOVED***
        assert_(cnt(a***REMOVED*** == cnt0_a + 10***REMOVED***
        assert_(cnt(b***REMOVED*** == cnt0_b + 5***REMOVED***

        arr2 = arr.flatten(***REMOVED***
        assert_(cnt(a***REMOVED*** == cnt0_a + 10***REMOVED***
        assert_(cnt(b***REMOVED*** == cnt0_b + 10***REMOVED***

        del arr, arr2

        # -- concatenate, repeat, take, choose

        arr1 = np.zeros((5, 1***REMOVED***, dtype=np.object_***REMOVED***
        arr2 = np.zeros((5, 1***REMOVED***, dtype=np.object_***REMOVED***

        arr1[...***REMOVED*** = a
        arr2[...***REMOVED*** = b
        assert_(cnt(a***REMOVED*** == cnt0_a + 5***REMOVED***
        assert_(cnt(b***REMOVED*** == cnt0_b + 5***REMOVED***

        tmp = np.concatenate((arr1, arr2***REMOVED******REMOVED***
        assert_(cnt(a***REMOVED*** == cnt0_a + 5 + 5***REMOVED***
        assert_(cnt(b***REMOVED*** == cnt0_b + 5 + 5***REMOVED***

        tmp = arr1.repeat(3, axis=0***REMOVED***
        assert_(cnt(a***REMOVED*** == cnt0_a + 5 + 3*5***REMOVED***

        tmp = arr1.take([1, 2, 3***REMOVED***, axis=0***REMOVED***
        assert_(cnt(a***REMOVED*** == cnt0_a + 5 + 3***REMOVED***

        x = np.array([[0***REMOVED***, [1***REMOVED***, [0***REMOVED***, [1***REMOVED***, [1***REMOVED******REMOVED***, int***REMOVED***
        tmp = x.choose(arr1, arr2***REMOVED***
        assert_(cnt(a***REMOVED*** == cnt0_a + 5 + 2***REMOVED***
        assert_(cnt(b***REMOVED*** == cnt0_b + 5 + 3***REMOVED***

        del tmp  # Avoid pyflakes unused variable warning

    def test_mem_custom_float_to_array(self, level=rlevel***REMOVED***:
        # Ticket 702
        class MyFloat(object***REMOVED***:
            def __float__(self***REMOVED***:
                return 1.0

        tmp = np.atleast_1d([MyFloat(***REMOVED******REMOVED******REMOVED***
        tmp.astype(float***REMOVED***  # Should succeed

    def test_object_array_refcount_self_assign(self, level=rlevel***REMOVED***:
        # Ticket #711
        class VictimObject(object***REMOVED***:
            deleted = False

            def __del__(self***REMOVED***:
                self.deleted = True

        d = VictimObject(***REMOVED***
        arr = np.zeros(5, dtype=np.object_***REMOVED***
        arr[:***REMOVED*** = d
        del d
        arr[:***REMOVED*** = arr  # refcount of 'd' might hit zero here
        assert_(not arr[0***REMOVED***.deleted***REMOVED***
        arr[:***REMOVED*** = arr  # trying to induce a segfault by doing it again...
        assert_(not arr[0***REMOVED***.deleted***REMOVED***

    def test_mem_fromiter_invalid_dtype_string(self, level=rlevel***REMOVED***:
        x = [1, 2, 3***REMOVED***
        self.assertRaises(ValueError,
                              np.fromiter, [xi for xi in x***REMOVED***, dtype='S'***REMOVED***

    def test_reduce_big_object_array(self, level=rlevel***REMOVED***:
        # Ticket #713
        oldsize = np.setbufsize(10*16***REMOVED***
        a = np.array([None***REMOVED****161, object***REMOVED***
        assert_(not np.any(a***REMOVED******REMOVED***
        np.setbufsize(oldsize***REMOVED***

    def test_mem_0d_array_index(self, level=rlevel***REMOVED***:
        # Ticket #714
        np.zeros(10***REMOVED***[np.array(0***REMOVED******REMOVED***

    def test_floats_from_string(self, level=rlevel***REMOVED***:
        # Ticket #640, floats from string
        fsingle = np.single('1.234'***REMOVED***
        fdouble = np.double('1.234'***REMOVED***
        flongdouble = np.longdouble('1.234'***REMOVED***
        assert_almost_equal(fsingle, 1.234***REMOVED***
        assert_almost_equal(fdouble, 1.234***REMOVED***
        assert_almost_equal(flongdouble, 1.234***REMOVED***

    def test_nonnative_endian_fill(self, level=rlevel***REMOVED***:
        # Non-native endian arrays were incorrectly filled with scalars
        # before r5034.
        if sys.byteorder == 'little':
            dtype = np.dtype('>i4'***REMOVED***
        else:
            dtype = np.dtype('<i4'***REMOVED***
        x = np.empty([1***REMOVED***, dtype=dtype***REMOVED***
        x.fill(1***REMOVED***
        assert_equal(x, np.array([1***REMOVED***, dtype=dtype***REMOVED******REMOVED***

    def test_dot_alignment_sse2(self, level=rlevel***REMOVED***:
        # Test for ticket #551, changeset r5140
        x = np.zeros((30, 40***REMOVED******REMOVED***
        y = pickle.loads(pickle.dumps(x***REMOVED******REMOVED***
        # y is now typically not aligned on a 8-byte boundary
        z = np.ones((1, y.shape[0***REMOVED******REMOVED******REMOVED***
        # This shouldn't cause a segmentation fault:
        np.dot(z, y***REMOVED***

    def test_astype_copy(self, level=rlevel***REMOVED***:
        # Ticket #788, changeset r5155
        # The test data file was generated by scipy.io.savemat.
        # The dtype is float64, but the isbuiltin attribute is 0.
        data_dir = path.join(path.dirname(__file__***REMOVED***, 'data'***REMOVED***
        filename = path.join(data_dir, "astype_copy.pkl"***REMOVED***
        if sys.version_info[0***REMOVED*** >= 3:
            f = open(filename, 'rb'***REMOVED***
            xp = pickle.load(f, encoding='latin1'***REMOVED***
            f.close(***REMOVED***
        else:
            f = open(filename***REMOVED***
            xp = pickle.load(f***REMOVED***
            f.close(***REMOVED***
        xpd = xp.astype(np.float64***REMOVED***
        assert_((xp.__array_interface__['data'***REMOVED***[0***REMOVED*** !=
                xpd.__array_interface__['data'***REMOVED***[0***REMOVED******REMOVED******REMOVED***

    def test_compress_small_type(self, level=rlevel***REMOVED***:
        # Ticket #789, changeset 5217.
        # compress with out argument segfaulted if cannot cast safely
        import numpy as np
        a = np.array([[1, 2***REMOVED***, [3, 4***REMOVED******REMOVED******REMOVED***
        b = np.zeros((2, 1***REMOVED***, dtype=np.single***REMOVED***
        ***REMOVED***
            a.compress([True, False***REMOVED***, axis=1, out=b***REMOVED***
            raise AssertionError("compress with an out which cannot be "
                                 "safely casted should not return "
                                 "successfully"***REMOVED***
        except TypeError:
            pass

    def test_attributes(self, level=rlevel***REMOVED***:
        # Ticket #791
        class TestArray(np.ndarray***REMOVED***:
            def __new__(cls, data, info***REMOVED***:
                result = np.array(data***REMOVED***
                result = result.view(cls***REMOVED***
                result.info = info
                return result

            def __array_finalize__(self, obj***REMOVED***:
                self.info = getattr(obj, 'info', ''***REMOVED***

        dat = TestArray([[1, 2, 3, 4***REMOVED***, [5, 6, 7, 8***REMOVED******REMOVED***, 'jubba'***REMOVED***
        assert_(dat.info == 'jubba'***REMOVED***
        dat.resize((4, 2***REMOVED******REMOVED***
        assert_(dat.info == 'jubba'***REMOVED***
        dat.sort(***REMOVED***
        assert_(dat.info == 'jubba'***REMOVED***
        dat.fill(2***REMOVED***
        assert_(dat.info == 'jubba'***REMOVED***
        dat.put([2, 3, 4***REMOVED***, [6, 3, 4***REMOVED******REMOVED***
        assert_(dat.info == 'jubba'***REMOVED***
        dat.setfield(4, np.int32, 0***REMOVED***
        assert_(dat.info == 'jubba'***REMOVED***
        dat.setflags(***REMOVED***
        assert_(dat.info == 'jubba'***REMOVED***
        assert_(dat.all(1***REMOVED***.info == 'jubba'***REMOVED***
        assert_(dat.any(1***REMOVED***.info == 'jubba'***REMOVED***
        assert_(dat.argmax(1***REMOVED***.info == 'jubba'***REMOVED***
        assert_(dat.argmin(1***REMOVED***.info == 'jubba'***REMOVED***
        assert_(dat.argsort(1***REMOVED***.info == 'jubba'***REMOVED***
        assert_(dat.astype(TestArray***REMOVED***.info == 'jubba'***REMOVED***
        assert_(dat.byteswap(***REMOVED***.info == 'jubba'***REMOVED***
        assert_(dat.clip(2, 7***REMOVED***.info == 'jubba'***REMOVED***
        assert_(dat.compress([0, 1, 1***REMOVED******REMOVED***.info == 'jubba'***REMOVED***
        assert_(dat.conj(***REMOVED***.info == 'jubba'***REMOVED***
        assert_(dat.conjugate(***REMOVED***.info == 'jubba'***REMOVED***
        assert_(dat.copy(***REMOVED***.info == 'jubba'***REMOVED***
        dat2 = TestArray([2, 3, 1, 0***REMOVED***, 'jubba'***REMOVED***
        choices = [[0, 1, 2, 3***REMOVED***, [10, 11, 12, 13***REMOVED***,
                   [20, 21, 22, 23***REMOVED***, [30, 31, 32, 33***REMOVED******REMOVED***
        assert_(dat2.choose(choices***REMOVED***.info == 'jubba'***REMOVED***
        assert_(dat.cumprod(1***REMOVED***.info == 'jubba'***REMOVED***
        assert_(dat.cumsum(1***REMOVED***.info == 'jubba'***REMOVED***
        assert_(dat.diagonal(***REMOVED***.info == 'jubba'***REMOVED***
        assert_(dat.flatten(***REMOVED***.info == 'jubba'***REMOVED***
        assert_(dat.getfield(np.int32, 0***REMOVED***.info == 'jubba'***REMOVED***
        assert_(dat.imag.info == 'jubba'***REMOVED***
        assert_(dat.max(1***REMOVED***.info == 'jubba'***REMOVED***
        assert_(dat.mean(1***REMOVED***.info == 'jubba'***REMOVED***
        assert_(dat.min(1***REMOVED***.info == 'jubba'***REMOVED***
        assert_(dat.newbyteorder(***REMOVED***.info == 'jubba'***REMOVED***
        assert_(dat.prod(1***REMOVED***.info == 'jubba'***REMOVED***
        assert_(dat.ptp(1***REMOVED***.info == 'jubba'***REMOVED***
        assert_(dat.ravel(***REMOVED***.info == 'jubba'***REMOVED***
        assert_(dat.real.info == 'jubba'***REMOVED***
        assert_(dat.repeat(2***REMOVED***.info == 'jubba'***REMOVED***
        assert_(dat.reshape((2, 4***REMOVED******REMOVED***.info == 'jubba'***REMOVED***
        assert_(dat.round(***REMOVED***.info == 'jubba'***REMOVED***
        assert_(dat.squeeze(***REMOVED***.info == 'jubba'***REMOVED***
        assert_(dat.std(1***REMOVED***.info == 'jubba'***REMOVED***
        assert_(dat.sum(1***REMOVED***.info == 'jubba'***REMOVED***
        assert_(dat.swapaxes(0, 1***REMOVED***.info == 'jubba'***REMOVED***
        assert_(dat.take([2, 3, 5***REMOVED******REMOVED***.info == 'jubba'***REMOVED***
        assert_(dat.transpose(***REMOVED***.info == 'jubba'***REMOVED***
        assert_(dat.T.info == 'jubba'***REMOVED***
        assert_(dat.var(1***REMOVED***.info == 'jubba'***REMOVED***
        assert_(dat.view(TestArray***REMOVED***.info == 'jubba'***REMOVED***
        # These methods do not preserve subclasses
        assert_(type(dat.nonzero(***REMOVED***[0***REMOVED******REMOVED*** is np.ndarray***REMOVED***
        assert_(type(dat.nonzero(***REMOVED***[1***REMOVED******REMOVED*** is np.ndarray***REMOVED***

    def test_recarray_tolist(self, level=rlevel***REMOVED***:
        # Ticket #793, changeset r5215
        # Comparisons fail for NaN, so we can't use random memory
        # for the test.
        buf = np.zeros(40, dtype=np.int8***REMOVED***
        a = np.recarray(2, formats="i4,f8,f8", names="id,x,y", buf=buf***REMOVED***
        b = a.tolist(***REMOVED***
        assert_( a[0***REMOVED***.tolist(***REMOVED*** == b[0***REMOVED******REMOVED***
        assert_( a[1***REMOVED***.tolist(***REMOVED*** == b[1***REMOVED******REMOVED***

    def test_nonscalar_item_method(self***REMOVED***:
        # Make sure that .item(***REMOVED*** fails graciously when it should
        a = np.arange(5***REMOVED***
        assert_raises(ValueError, a.item***REMOVED***

    def test_char_array_creation(self, level=rlevel***REMOVED***:
        a = np.array('123', dtype='c'***REMOVED***
        b = np.array(asbytes_nested(['1', '2', '3'***REMOVED******REMOVED******REMOVED***
        assert_equal(a, b***REMOVED***

    def test_unaligned_unicode_access(self, level=rlevel***REMOVED***:
        # Ticket #825
        for i in range(1, 9***REMOVED***:
            msg = 'unicode offset: %d chars' % i
            t = np.dtype([('a', 'S%d' % i***REMOVED***, ('b', 'U2'***REMOVED******REMOVED******REMOVED***
            x = np.array([(asbytes('a'***REMOVED***, sixu('b'***REMOVED******REMOVED******REMOVED***, dtype=t***REMOVED***
            if sys.version_info[0***REMOVED*** >= 3:
                assert_equal(str(x***REMOVED***, "[(b'a', 'b'***REMOVED******REMOVED***", err_msg=msg***REMOVED***
            else:
                assert_equal(str(x***REMOVED***, "[('a', u'b'***REMOVED******REMOVED***", err_msg=msg***REMOVED***

    def test_sign_for_complex_nan(self, level=rlevel***REMOVED***:
        # Ticket 794.
        with np.errstate(invalid='ignore'***REMOVED***:
            C = np.array([-np.inf, -2+1j, 0, 2-1j, np.inf, np.nan***REMOVED******REMOVED***
            have = np.sign(C***REMOVED***
            want = np.array([-1+0j, -1+0j, 0+0j, 1+0j, 1+0j, np.nan***REMOVED******REMOVED***
            assert_equal(have, want***REMOVED***

    def test_for_equal_names(self, level=rlevel***REMOVED***:
        # Ticket #674
        dt = np.dtype([('foo', float***REMOVED***, ('bar', float***REMOVED******REMOVED******REMOVED***
        a = np.zeros(10, dt***REMOVED***
        b = list(a.dtype.names***REMOVED***
        b[0***REMOVED*** = "notfoo"
        a.dtype.names = b
        assert_(a.dtype.names[0***REMOVED*** == "notfoo"***REMOVED***
        assert_(a.dtype.names[1***REMOVED*** == "bar"***REMOVED***

    def test_for_object_scalar_creation(self, level=rlevel***REMOVED***:
        # Ticket #816
        a = np.object_(***REMOVED***
        b = np.object_(3***REMOVED***
        b2 = np.object_(3.0***REMOVED***
        c = np.object_([4, 5***REMOVED******REMOVED***
        d = np.object_([None, {***REMOVED***, [***REMOVED******REMOVED******REMOVED***
        assert_(a is None***REMOVED***
        assert_(type(b***REMOVED*** is int***REMOVED***
        assert_(type(b2***REMOVED*** is float***REMOVED***
        assert_(type(c***REMOVED*** is np.ndarray***REMOVED***
        assert_(c.dtype == object***REMOVED***
        assert_(d.dtype == object***REMOVED***

    def test_array_resize_method_system_error(self***REMOVED***:
        # Ticket #840 - order should be an invalid keyword.
        x = np.array([[0, 1***REMOVED***, [2, 3***REMOVED******REMOVED******REMOVED***
        self.assertRaises(TypeError, x.resize, (2, 2***REMOVED***, order='C'***REMOVED***

    def test_for_zero_length_in_choose(self, level=rlevel***REMOVED***:
        "Ticket #882"
        a = np.array(1***REMOVED***
        self.assertRaises(ValueError, lambda x: x.choose([***REMOVED******REMOVED***, a***REMOVED***

    def test_array_ndmin_overflow(self***REMOVED***:
        "Ticket #947."
        self.assertRaises(ValueError, lambda: np.array([1***REMOVED***, ndmin=33***REMOVED******REMOVED***

    def test_errobj_reference_leak(self, level=rlevel***REMOVED***:
        # Ticket #955
        with np.errstate(all="ignore"***REMOVED***:
            z = int(0***REMOVED***
            p = np.int32(-1***REMOVED***

            gc.collect(***REMOVED***
            n_before = len(gc.get_objects(***REMOVED******REMOVED***
            z**p  # this shouldn't leak a reference to errobj
            gc.collect(***REMOVED***
            n_after = len(gc.get_objects(***REMOVED******REMOVED***
            assert_(n_before >= n_after, (n_before, n_after***REMOVED******REMOVED***

    def test_void_scalar_with_titles(self, level=rlevel***REMOVED***:
        # No ticket
        data = [('john', 4***REMOVED***, ('mary', 5***REMOVED******REMOVED***
        dtype1 = [(('source:yy', 'name'***REMOVED***, 'O'***REMOVED***, (('source:xx', 'id'***REMOVED***, int***REMOVED******REMOVED***
        arr = np.array(data, dtype=dtype1***REMOVED***
        assert_(arr[0***REMOVED***[0***REMOVED*** == 'john'***REMOVED***
        assert_(arr[0***REMOVED***[1***REMOVED*** == 4***REMOVED***

    def test_void_scalar_constructor(self***REMOVED***:
        #Issue #1550

        #Create test string data, construct void scalar from data and assert
        #that void scalar contains original data.
        test_string = np.array("test"***REMOVED***
        test_string_void_scalar = np.core.multiarray.scalar(
            np.dtype(("V", test_string.dtype.itemsize***REMOVED******REMOVED***, test_string.tobytes(***REMOVED******REMOVED***

        assert_(test_string_void_scalar.view(test_string.dtype***REMOVED*** == test_string***REMOVED***

        #Create record scalar, construct from data and assert that
        #reconstructed scalar is correct.
        test_record = np.ones((***REMOVED***, "i,i"***REMOVED***
        test_record_void_scalar = np.core.multiarray.scalar(
            test_record.dtype, test_record.tobytes(***REMOVED******REMOVED***

        assert_(test_record_void_scalar == test_record***REMOVED***

        #Test pickle and unpickle of void and record scalars
        assert_(pickle.loads(pickle.dumps(test_string***REMOVED******REMOVED*** == test_string***REMOVED***
        assert_(pickle.loads(pickle.dumps(test_record***REMOVED******REMOVED*** == test_record***REMOVED***

    def test_blasdot_uninitialized_memory(self***REMOVED***:
        # Ticket #950
        for m in [0, 1, 2***REMOVED***:
            for n in [0, 1, 2***REMOVED***:
                for k in range(3***REMOVED***:
                    # Try to ensure that x->data contains non-zero floats
                    x = np.array([123456789e199***REMOVED***, dtype=np.float64***REMOVED***
                    x.resize((m, 0***REMOVED******REMOVED***
                    y = np.array([123456789e199***REMOVED***, dtype=np.float64***REMOVED***
                    y.resize((0, n***REMOVED******REMOVED***

                    # `dot` should just return zero (m,n***REMOVED*** matrix
                    z = np.dot(x, y***REMOVED***
                    assert_(np.all(z == 0***REMOVED******REMOVED***
                    assert_(z.shape == (m, n***REMOVED******REMOVED***

    def test_zeros(self***REMOVED***:
        # Regression test for #1061.
        # Set a size which cannot fit into a 64 bits signed integer
        sz = 2 ** 64
        good = 'Maximum allowed dimension exceeded'
        ***REMOVED***
            np.empty(sz***REMOVED***
        except ValueError as e:
            if not str(e***REMOVED*** == good:
                self.fail("Got msg '%s', expected '%s'" % (e, good***REMOVED******REMOVED***
        except Exception as e:
            self.fail("Got exception of type %s instead of ValueError" % type(e***REMOVED******REMOVED***

    def test_huge_arange(self***REMOVED***:
        # Regression test for #1062.
        # Set a size which cannot fit into a 64 bits signed integer
        sz = 2 ** 64
        good = 'Maximum allowed size exceeded'
        ***REMOVED***
            np.arange(sz***REMOVED***
            self.assertTrue(np.size == sz***REMOVED***
        except ValueError as e:
            if not str(e***REMOVED*** == good:
                self.fail("Got msg '%s', expected '%s'" % (e, good***REMOVED******REMOVED***
        except Exception as e:
            self.fail("Got exception of type %s instead of ValueError" % type(e***REMOVED******REMOVED***

    def test_fromiter_bytes(self***REMOVED***:
        # Ticket #1058
        a = np.fromiter(list(range(10***REMOVED******REMOVED***, dtype='b'***REMOVED***
        b = np.fromiter(list(range(10***REMOVED******REMOVED***, dtype='B'***REMOVED***
        assert_(np.alltrue(a == np.array([0, 1, 2, 3, 4, 5, 6, 7, 8, 9***REMOVED******REMOVED******REMOVED******REMOVED***
        assert_(np.alltrue(b == np.array([0, 1, 2, 3, 4, 5, 6, 7, 8, 9***REMOVED******REMOVED******REMOVED******REMOVED***

    def test_array_from_sequence_scalar_array(self***REMOVED***:
        # Ticket #1078: segfaults when creating an array with a sequence of
        # 0d arrays.
        a = np.array((np.ones(2***REMOVED***, np.array(2***REMOVED******REMOVED******REMOVED***
        assert_equal(a.shape, (2,***REMOVED******REMOVED***
        assert_equal(a.dtype, np.dtype(object***REMOVED******REMOVED***
        assert_equal(a[0***REMOVED***, np.ones(2***REMOVED******REMOVED***
        assert_equal(a[1***REMOVED***, np.array(2***REMOVED******REMOVED***

        a = np.array(((1,***REMOVED***, np.array(1***REMOVED******REMOVED******REMOVED***
        assert_equal(a.shape, (2,***REMOVED******REMOVED***
        assert_equal(a.dtype, np.dtype(object***REMOVED******REMOVED***
        assert_equal(a[0***REMOVED***, (1,***REMOVED******REMOVED***
        assert_equal(a[1***REMOVED***, np.array(1***REMOVED******REMOVED***

    def test_array_from_sequence_scalar_array2(self***REMOVED***:
        # Ticket #1081: weird array with strange input...
        t = np.array([np.array([***REMOVED******REMOVED***, np.array(0, object***REMOVED******REMOVED******REMOVED***
        assert_equal(t.shape, (2,***REMOVED******REMOVED***
        assert_equal(t.dtype, np.dtype(object***REMOVED******REMOVED***

    def test_array_too_big(self***REMOVED***:
        # Ticket #1080.
        assert_raises(ValueError, np.zeros, [975***REMOVED****7, np.int8***REMOVED***
        assert_raises(ValueError, np.zeros, [26244***REMOVED****5, np.int8***REMOVED***

    def test_dtype_keyerrors_(self***REMOVED***:
        # Ticket #1106.
        dt = np.dtype([('f1', np.uint***REMOVED******REMOVED******REMOVED***
        assert_raises(KeyError, dt.__getitem__, "f2"***REMOVED***
        assert_raises(IndexError, dt.__getitem__, 1***REMOVED***
        assert_raises(ValueError, dt.__getitem__, 0.0***REMOVED***

    def test_lexsort_buffer_length(self***REMOVED***:
        # Ticket #1217, don't segfault.
        a = np.ones(100, dtype=np.int8***REMOVED***
        b = np.ones(100, dtype=np.int32***REMOVED***
        i = np.lexsort((a[::-1***REMOVED***, b***REMOVED******REMOVED***
        assert_equal(i, np.arange(100, dtype=np.int***REMOVED******REMOVED***

    def test_object_array_to_fixed_string(self***REMOVED***:
        # Ticket #1235.
        a = np.array(['abcdefgh', 'ijklmnop'***REMOVED***, dtype=np.object_***REMOVED***
        b = np.array(a, dtype=(np.str_, 8***REMOVED******REMOVED***
        assert_equal(a, b***REMOVED***
        c = np.array(a, dtype=(np.str_, 5***REMOVED******REMOVED***
        assert_equal(c, np.array(['abcde', 'ijklm'***REMOVED******REMOVED******REMOVED***
        d = np.array(a, dtype=(np.str_, 12***REMOVED******REMOVED***
        assert_equal(a, d***REMOVED***
        e = np.empty((2, ***REMOVED***, dtype=(np.str_, 8***REMOVED******REMOVED***
        e[:***REMOVED*** = a[:***REMOVED***
        assert_equal(a, e***REMOVED***

    def test_unicode_to_string_cast(self***REMOVED***:
        # Ticket #1240.
        a = np.array([[sixu('abc'***REMOVED***, sixu('\u03a3'***REMOVED******REMOVED***,
                      [sixu('asdf'***REMOVED***, sixu('erw'***REMOVED******REMOVED******REMOVED***,
                     dtype='U'***REMOVED***
        self.assertRaises(UnicodeEncodeError, np.array, a, 'S4'***REMOVED***

    def test_mixed_string_unicode_array_creation(self***REMOVED***:
        a = np.array(['1234', sixu('123'***REMOVED******REMOVED******REMOVED***
        assert_(a.itemsize == 16***REMOVED***
        a = np.array([sixu('123'***REMOVED***, '1234'***REMOVED******REMOVED***
        assert_(a.itemsize == 16***REMOVED***
        a = np.array(['1234', sixu('123'***REMOVED***, '12345'***REMOVED******REMOVED***
        assert_(a.itemsize == 20***REMOVED***
        a = np.array([sixu('123'***REMOVED***, '1234', sixu('12345'***REMOVED******REMOVED******REMOVED***
        assert_(a.itemsize == 20***REMOVED***
        a = np.array([sixu('123'***REMOVED***, '1234', sixu('1234'***REMOVED******REMOVED******REMOVED***
        assert_(a.itemsize == 16***REMOVED***

    def test_misaligned_objects_segfault(self***REMOVED***:
        # Ticket #1198 and #1267
        a1 = np.zeros((10,***REMOVED***, dtype='O,c'***REMOVED***
        a2 = np.array(['a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j'***REMOVED***, 'S10'***REMOVED***
        a1['f0'***REMOVED*** = a2
        repr(a1***REMOVED***
        np.argmax(a1['f0'***REMOVED******REMOVED***
        a1['f0'***REMOVED***[1***REMOVED*** = "FOO"
        a1['f0'***REMOVED*** = "FOO"
        np.array(a1['f0'***REMOVED***, dtype='S'***REMOVED***
        np.nonzero(a1['f0'***REMOVED******REMOVED***
        a1.sort(***REMOVED***
        copy.deepcopy(a1***REMOVED***

    def test_misaligned_scalars_segfault(self***REMOVED***:
        # Ticket #1267
        s1 = np.array(('a', 'Foo'***REMOVED***, dtype='c,O'***REMOVED***
        s2 = np.array(('b', 'Bar'***REMOVED***, dtype='c,O'***REMOVED***
        s1['f1'***REMOVED*** = s2['f1'***REMOVED***
        s1['f1'***REMOVED*** = 'Baz'

    def test_misaligned_dot_product_objects(self***REMOVED***:
        # Ticket #1267
        # This didn't require a fix, but it's worth testing anyway, because
        # it may fail if .dot stops enforcing the arrays to be BEHAVED
        a = np.array([[(1, 'a'***REMOVED***, (0, 'a'***REMOVED******REMOVED***, [(0, 'a'***REMOVED***, (1, 'a'***REMOVED******REMOVED******REMOVED***, dtype='O,c'***REMOVED***
        b = np.array([[(4, 'a'***REMOVED***, (1, 'a'***REMOVED******REMOVED***, [(2, 'a'***REMOVED***, (2, 'a'***REMOVED******REMOVED******REMOVED***, dtype='O,c'***REMOVED***
        np.dot(a['f0'***REMOVED***, b['f0'***REMOVED******REMOVED***

    def test_byteswap_complex_scalar(self***REMOVED***:
        # Ticket #1259 and gh-441
        for dtype in [np.dtype('<'+t***REMOVED*** for t in np.typecodes['Complex'***REMOVED******REMOVED***:
            z = np.array([2.2-1.1j***REMOVED***, dtype***REMOVED***
            x = z[0***REMOVED***  # always native-endian
            y = x.byteswap(***REMOVED***
            if x.dtype.byteorder == z.dtype.byteorder:
                # little-endian machine
                assert_equal(x, np.fromstring(y.tobytes(***REMOVED***, dtype=dtype.newbyteorder(***REMOVED******REMOVED******REMOVED***
            else:
                # big-endian machine
                assert_equal(x, np.fromstring(y.tobytes(***REMOVED***, dtype=dtype***REMOVED******REMOVED***
            # double check real and imaginary parts:
            assert_equal(x.real, y.real.byteswap(***REMOVED******REMOVED***
            assert_equal(x.imag, y.imag.byteswap(***REMOVED******REMOVED***

    def test_structured_arrays_with_objects1(self***REMOVED***:
        # Ticket #1299
        stra = 'aaaa'
        strb = 'bbbb'
        x = np.array([[(0, stra***REMOVED***, (1, strb***REMOVED******REMOVED******REMOVED***, 'i8,O'***REMOVED***
        x[x.nonzero(***REMOVED******REMOVED*** = x.ravel(***REMOVED***[:1***REMOVED***
        assert_(x[0, 1***REMOVED*** == x[0, 0***REMOVED******REMOVED***

    def test_structured_arrays_with_objects2(self***REMOVED***:
        # Ticket #1299 second test
        stra = 'aaaa'
        strb = 'bbbb'
        numb = sys.getrefcount(strb***REMOVED***
        numa = sys.getrefcount(stra***REMOVED***
        x = np.array([[(0, stra***REMOVED***, (1, strb***REMOVED******REMOVED******REMOVED***, 'i8,O'***REMOVED***
        x[x.nonzero(***REMOVED******REMOVED*** = x.ravel(***REMOVED***[:1***REMOVED***
        assert_(sys.getrefcount(strb***REMOVED*** == numb***REMOVED***
        assert_(sys.getrefcount(stra***REMOVED*** == numa + 2***REMOVED***

    def test_duplicate_title_and_name(self***REMOVED***:
        # Ticket #1254
        dtspec = [(('a', 'a'***REMOVED***, 'i'***REMOVED***, ('b', 'i'***REMOVED******REMOVED***
        self.assertRaises(ValueError, np.dtype, dtspec***REMOVED***

    def test_signed_integer_division_overflow(self***REMOVED***:
        # Ticket #1317.
        def test_type(t***REMOVED***:
            min = np.array([np.iinfo(t***REMOVED***.min***REMOVED******REMOVED***
            min //= -1

        with np.errstate(divide="ignore"***REMOVED***:
            for t in (np.int8, np.int16, np.int32, np.int64, np.int, np.long***REMOVED***:
                test_type(t***REMOVED***

    def test_buffer_hashlib(self***REMOVED***:
        ***REMOVED***
            from hashlib import md5
        except ImportError:
            from md5 import new as md5

        x = np.array([1, 2, 3***REMOVED***, dtype=np.dtype('<i4'***REMOVED******REMOVED***
        assert_equal(md5(x***REMOVED***.hexdigest(***REMOVED***, '2a1dd1e1e59d0a384c26951e316cd7e6'***REMOVED***

    def test_0d_string_scalar(self***REMOVED***:
        # Bug #1436; the following should succeed
        np.asarray('x', '>c'***REMOVED***

    def test_log1p_compiler_shenanigans(self***REMOVED***:
        # Check if log1p is behaving on 32 bit intel systems.
        assert_(np.isfinite(np.log1p(np.exp2(-53***REMOVED******REMOVED******REMOVED******REMOVED***

    def test_fromiter_comparison(self, level=rlevel***REMOVED***:
        a = np.fromiter(list(range(10***REMOVED******REMOVED***, dtype='b'***REMOVED***
        b = np.fromiter(list(range(10***REMOVED******REMOVED***, dtype='B'***REMOVED***
        assert_(np.alltrue(a == np.array([0, 1, 2, 3, 4, 5, 6, 7, 8, 9***REMOVED******REMOVED******REMOVED******REMOVED***
        assert_(np.alltrue(b == np.array([0, 1, 2, 3, 4, 5, 6, 7, 8, 9***REMOVED******REMOVED******REMOVED******REMOVED***

    def test_fromstring_crash(self***REMOVED***:
        # Ticket #1345: the following should not cause a crash
        np.fromstring(asbytes('aa, aa, 1.0'***REMOVED***, sep=','***REMOVED***

    def test_ticket_1539(self***REMOVED***:
        dtypes = [x for x in np.typeDict.values(***REMOVED***
                  if (issubclass(x, np.number***REMOVED***
                      and not issubclass(x, np.timedelta64***REMOVED******REMOVED******REMOVED***
        a = np.array([***REMOVED***, dtypes[0***REMOVED******REMOVED***
        failures = [***REMOVED***
        # ignore complex warnings
        with warnings.catch_warnings(***REMOVED***:
            warnings.simplefilter('ignore', np.ComplexWarning***REMOVED***
            for x in dtypes:
                b = a.astype(x***REMOVED***
                for y in dtypes:
                    c = a.astype(y***REMOVED***
                    ***REMOVED***
                        np.dot(b, c***REMOVED***
                    except TypeError:
                        failures.append((x, y***REMOVED******REMOVED***
        if failures:
            raise AssertionError("Failures: %r" % failures***REMOVED***

    def test_ticket_1538(self***REMOVED***:
        x = np.finfo(np.float32***REMOVED***
        for name in 'eps epsneg max min resolution tiny'.split(***REMOVED***:
            assert_equal(type(getattr(x, name***REMOVED******REMOVED***, np.float32,
                         err_msg=name***REMOVED***

    def test_ticket_1434(self***REMOVED***:
        # Check that the out= argument in var and std has an effect
        data = np.array(((1, 2, 3***REMOVED***, (4, 5, 6***REMOVED***, (7, 8, 9***REMOVED******REMOVED******REMOVED***
        out = np.zeros((3,***REMOVED******REMOVED***

        ret = data.var(axis=1, out=out***REMOVED***
        assert_(ret is out***REMOVED***
        assert_array_equal(ret, data.var(axis=1***REMOVED******REMOVED***

        ret = data.std(axis=1, out=out***REMOVED***
        assert_(ret is out***REMOVED***
        assert_array_equal(ret, data.std(axis=1***REMOVED******REMOVED***

    def test_complex_nan_maximum(self***REMOVED***:
        cnan = complex(0, np.nan***REMOVED***
        assert_equal(np.maximum(1, cnan***REMOVED***, cnan***REMOVED***

    def test_subclass_int_tuple_assignment(self***REMOVED***:
        # ticket #1563
        class Subclass(np.ndarray***REMOVED***:
            def __new__(cls, i***REMOVED***:
                return np.ones((i,***REMOVED******REMOVED***.view(cls***REMOVED***

        x = Subclass(5***REMOVED***
        x[(0,***REMOVED******REMOVED*** = 2  # shouldn't raise an exception
        assert_equal(x[0***REMOVED***, 2***REMOVED***

    def test_ufunc_no_unnecessary_views(self***REMOVED***:
        # ticket #1548
        class Subclass(np.ndarray***REMOVED***:
            pass
        x = np.array([1, 2, 3***REMOVED******REMOVED***.view(Subclass***REMOVED***
        y = np.add(x, x, x***REMOVED***
        assert_equal(id(x***REMOVED***, id(y***REMOVED******REMOVED***

    def test_take_refcount(self***REMOVED***:
        # ticket #939
        a = np.arange(16, dtype=np.float***REMOVED***
        a.shape = (4, 4***REMOVED***
        lut = np.ones((5 + 3, 4***REMOVED***, np.float***REMOVED***
        rgba = np.empty(shape=a.shape + (4,***REMOVED***, dtype=lut.dtype***REMOVED***
        c1 = sys.getrefcount(rgba***REMOVED***
        ***REMOVED***
            lut.take(a, axis=0, mode='clip', out=rgba***REMOVED***
        except TypeError:
            pass
        c2 = sys.getrefcount(rgba***REMOVED***
        assert_equal(c1, c2***REMOVED***

    def test_fromfile_tofile_seeks(self***REMOVED***:
        # On Python 3, tofile/fromfile used to get (#1610***REMOVED*** the Python
        # file handle out of sync
        f0 = tempfile.NamedTemporaryFile(***REMOVED***
        f = f0.file
        f.write(np.arange(255, dtype='u1'***REMOVED***.tobytes(***REMOVED******REMOVED***

        f.seek(20***REMOVED***
        ret = np.fromfile(f, count=4, dtype='u1'***REMOVED***
        assert_equal(ret, np.array([20, 21, 22, 23***REMOVED***, dtype='u1'***REMOVED******REMOVED***
        assert_equal(f.tell(***REMOVED***, 24***REMOVED***

        f.seek(40***REMOVED***
        np.array([1, 2, 3***REMOVED***, dtype='u1'***REMOVED***.tofile(f***REMOVED***
        assert_equal(f.tell(***REMOVED***, 43***REMOVED***

        f.seek(40***REMOVED***
        data = f.read(3***REMOVED***
        assert_equal(data, asbytes("\x01\x02\x03"***REMOVED******REMOVED***

        f.seek(80***REMOVED***
        f.read(4***REMOVED***
        data = np.fromfile(f, dtype='u1', count=4***REMOVED***
        assert_equal(data, np.array([84, 85, 86, 87***REMOVED***, dtype='u1'***REMOVED******REMOVED***

        f.close(***REMOVED***

    def test_complex_scalar_warning(self***REMOVED***:
        for tp in [np.csingle, np.cdouble, np.clongdouble***REMOVED***:
            x = tp(1+2j***REMOVED***
            assert_warns(np.ComplexWarning, float, x***REMOVED***
            with warnings.catch_warnings(***REMOVED***:
                warnings.simplefilter('ignore'***REMOVED***
                assert_equal(float(x***REMOVED***, float(x.real***REMOVED******REMOVED***

    def test_complex_scalar_complex_cast(self***REMOVED***:
        for tp in [np.csingle, np.cdouble, np.clongdouble***REMOVED***:
            x = tp(1+2j***REMOVED***
            assert_equal(complex(x***REMOVED***, 1+2j***REMOVED***

    def test_complex_boolean_cast(self***REMOVED***:
        # Ticket #2218
        for tp in [np.csingle, np.cdouble, np.clongdouble***REMOVED***:
            x = np.array([0, 0+0.5j, 0.5+0j***REMOVED***, dtype=tp***REMOVED***
            assert_equal(x.astype(bool***REMOVED***, np.array([0, 1, 1***REMOVED***, dtype=bool***REMOVED******REMOVED***
            assert_(np.any(x***REMOVED******REMOVED***
            assert_(np.all(x[1:***REMOVED******REMOVED******REMOVED***

    def test_uint_int_conversion(self***REMOVED***:
        x = 2**64 - 1
        assert_equal(int(np.uint64(x***REMOVED******REMOVED***, x***REMOVED***

    def test_duplicate_field_names_assign(self***REMOVED***:
        ra = np.fromiter(((i*3, i*2***REMOVED*** for i in range(10***REMOVED******REMOVED***, dtype='i8,f8'***REMOVED***
        ra.dtype.names = ('f1', 'f2'***REMOVED***
        repr(ra***REMOVED***  # should not cause a segmentation fault
        assert_raises(ValueError, setattr, ra.dtype, 'names', ('f1', 'f1'***REMOVED******REMOVED***

    def test_eq_string_and_object_array(self***REMOVED***:
        # From e-mail thread "__eq__ with str and object" (Keith Goodman***REMOVED***
        a1 = np.array(['a', 'b'***REMOVED***, dtype=object***REMOVED***
        a2 = np.array(['a', 'c'***REMOVED******REMOVED***
        assert_array_equal(a1 == a2, [True, False***REMOVED******REMOVED***
        assert_array_equal(a2 == a1, [True, False***REMOVED******REMOVED***

    def test_nonzero_byteswap(self***REMOVED***:
        a = np.array([0x80000000, 0x00000080, 0***REMOVED***, dtype=np.uint32***REMOVED***
        a.dtype = np.float32
        assert_equal(a.nonzero(***REMOVED***[0***REMOVED***, [1***REMOVED******REMOVED***
        a = a.byteswap(***REMOVED***.newbyteorder(***REMOVED***
        assert_equal(a.nonzero(***REMOVED***[0***REMOVED***, [1***REMOVED******REMOVED***  # [0***REMOVED*** if nonzero(***REMOVED*** ignores swap

    def test_find_common_type_boolean(self***REMOVED***:
        # Ticket #1695
        assert_(np.find_common_type([***REMOVED***, ['?', '?'***REMOVED******REMOVED*** == '?'***REMOVED***

    def test_empty_mul(self***REMOVED***:
        a = np.array([1.***REMOVED******REMOVED***
        a[1:1***REMOVED*** *= 2
        assert_equal(a, [1.***REMOVED******REMOVED***

    def test_array_side_effect(self***REMOVED***:
        # The second use of itemsize was throwing an exception because in
        # ctors.c, discover_itemsize was calling PyObject_Length without
        # checking the return code.  This failed to get the length of the
        # number 2, and the exception hung around until something checked
        # PyErr_Occurred(***REMOVED*** and returned an error.
        assert_equal(np.dtype('S10'***REMOVED***.itemsize, 10***REMOVED***
        np.array([['abc', 2***REMOVED***, ['long   ', '0123456789'***REMOVED******REMOVED***, dtype=np.string_***REMOVED***
        assert_equal(np.dtype('S10'***REMOVED***.itemsize, 10***REMOVED***

    def test_any_float(self***REMOVED***:
        # all and any for floats
        a = np.array([0.1, 0.9***REMOVED******REMOVED***
        assert_(np.any(a***REMOVED******REMOVED***
        assert_(np.all(a***REMOVED******REMOVED***

    def test_large_float_sum(self***REMOVED***:
        a = np.arange(10000, dtype='f'***REMOVED***
        assert_equal(a.sum(dtype='d'***REMOVED***, a.astype('d'***REMOVED***.sum(***REMOVED******REMOVED***

    def test_ufunc_casting_out(self***REMOVED***:
        a = np.array(1.0, dtype=np.float32***REMOVED***
        b = np.array(1.0, dtype=np.float64***REMOVED***
        c = np.array(1.0, dtype=np.float32***REMOVED***
        np.add(a, b, out=c***REMOVED***
        assert_equal(c, 2.0***REMOVED***

    def test_array_scalar_contiguous(self***REMOVED***:
        # Array scalars are both C and Fortran contiguous
        assert_(np.array(1.0***REMOVED***.flags.c_contiguous***REMOVED***
        assert_(np.array(1.0***REMOVED***.flags.f_contiguous***REMOVED***
        assert_(np.array(np.float32(1.0***REMOVED******REMOVED***.flags.c_contiguous***REMOVED***
        assert_(np.array(np.float32(1.0***REMOVED******REMOVED***.flags.f_contiguous***REMOVED***

    def test_squeeze_contiguous(self***REMOVED***:
        # Similar to GitHub issue #387
        a = np.zeros((1, 2***REMOVED******REMOVED***.squeeze(***REMOVED***
        b = np.zeros((2, 2, 2***REMOVED***, order='F'***REMOVED***[:,:, ::2***REMOVED***.squeeze(***REMOVED***
        assert_(a.flags.c_contiguous***REMOVED***
        assert_(a.flags.f_contiguous***REMOVED***
        assert_(b.flags.f_contiguous***REMOVED***

    def test_reduce_contiguous(self***REMOVED***:
        # GitHub issue #387
        a = np.add.reduce(np.zeros((2, 1, 2***REMOVED******REMOVED***, (0, 1***REMOVED******REMOVED***
        b = np.add.reduce(np.zeros((2, 1, 2***REMOVED******REMOVED***, 1***REMOVED***
        assert_(a.flags.c_contiguous***REMOVED***
        assert_(a.flags.f_contiguous***REMOVED***
        assert_(b.flags.c_contiguous***REMOVED***

    def test_object_array_self_reference(self***REMOVED***:
        # Object arrays with references to themselves can cause problems
        a = np.array(0, dtype=object***REMOVED***
        a[(***REMOVED******REMOVED*** = a
        assert_raises(TypeError, int, a***REMOVED***
        assert_raises(TypeError, long, a***REMOVED***
        assert_raises(TypeError, float, a***REMOVED***
        assert_raises(TypeError, oct, a***REMOVED***
        assert_raises(TypeError, hex, a***REMOVED***

        # Test the same for a circular reference.
        b = np.array(a, dtype=object***REMOVED***
        a[(***REMOVED******REMOVED*** = b
        assert_raises(TypeError, int, a***REMOVED***
        # Numpy has no tp_traverse currently, so circular references
        # cannot be detected. So resolve it:
        a[(***REMOVED******REMOVED*** = 0

        # This was causing a to become like the above
        a = np.array(0, dtype=object***REMOVED***
        a[...***REMOVED*** += 1
        assert_equal(a, 1***REMOVED***

    def test_object_array_self_copy(self***REMOVED***:
        # An object array being copied into itself DECREF'ed before INCREF'ing
        # causing segmentation faults (gh-3787***REMOVED***
        a = np.array(object(***REMOVED***, dtype=object***REMOVED***
        np.copyto(a, a***REMOVED***
        assert_equal(sys.getrefcount(a[(***REMOVED******REMOVED******REMOVED***, 2***REMOVED***
        a[(***REMOVED******REMOVED***.__class__  # will segfault if object was deleted

    def test_zerosize_accumulate(self***REMOVED***:
        "Ticket #1733"
        x = np.array([[42, 0***REMOVED******REMOVED***, dtype=np.uint32***REMOVED***
        assert_equal(np.add.accumulate(x[:-1, 0***REMOVED******REMOVED***, [***REMOVED******REMOVED***

    def test_objectarray_setfield(self***REMOVED***:
        # Setfield should not overwrite Object fields with non-Object data
        x = np.array([1, 2, 3***REMOVED***, dtype=object***REMOVED***
        assert_raises(TypeError, x.setfield, 4, np.int32, 0***REMOVED***

    def test_setting_rank0_string(self***REMOVED***:
        "Ticket #1736"
        s1 = asbytes("hello1"***REMOVED***
        s2 = asbytes("hello2"***REMOVED***
        a = np.zeros((***REMOVED***, dtype="S10"***REMOVED***
        a[(***REMOVED******REMOVED*** = s1
        assert_equal(a, np.array(s1***REMOVED******REMOVED***
        a[(***REMOVED******REMOVED*** = np.array(s2***REMOVED***
        assert_equal(a, np.array(s2***REMOVED******REMOVED***

        a = np.zeros((***REMOVED***, dtype='f4'***REMOVED***
        a[(***REMOVED******REMOVED*** = 3
        assert_equal(a, np.array(3***REMOVED******REMOVED***
        a[(***REMOVED******REMOVED*** = np.array(4***REMOVED***
        assert_equal(a, np.array(4***REMOVED******REMOVED***

    def test_string_astype(self***REMOVED***:
        "Ticket #1748"
        s1 = asbytes('black'***REMOVED***
        s2 = asbytes('white'***REMOVED***
        s3 = asbytes('other'***REMOVED***
        a = np.array([[s1***REMOVED***, [s2***REMOVED***, [s3***REMOVED******REMOVED******REMOVED***
        assert_equal(a.dtype, np.dtype('S5'***REMOVED******REMOVED***
        b = a.astype(np.dtype('S0'***REMOVED******REMOVED***
        assert_equal(b.dtype, np.dtype('S5'***REMOVED******REMOVED***

    def test_ticket_1756(self***REMOVED***:
        # Ticket #1756
        s = asbytes('0123456789abcdef'***REMOVED***
        a = np.array([s***REMOVED****5***REMOVED***
        for i in range(1, 17***REMOVED***:
            a1 = np.array(a, "|S%d" % i***REMOVED***
            a2 = np.array([s[:i***REMOVED******REMOVED****5***REMOVED***
            assert_equal(a1, a2***REMOVED***

    def test_fields_strides(self***REMOVED***:
        "Ticket #1760"
        r = np.fromstring('abcdefghijklmnop'*4*3, dtype='i4,(2,3***REMOVED***u2'***REMOVED***
        assert_equal(r[0:3:2***REMOVED***['f1'***REMOVED***, r['f1'***REMOVED***[0:3:2***REMOVED******REMOVED***
        assert_equal(r[0:3:2***REMOVED***['f1'***REMOVED***[0***REMOVED***, r[0:3:2***REMOVED***[0***REMOVED***['f1'***REMOVED******REMOVED***
        assert_equal(r[0:3:2***REMOVED***['f1'***REMOVED***[0***REMOVED***[(***REMOVED******REMOVED***, r[0:3:2***REMOVED***[0***REMOVED***['f1'***REMOVED***[(***REMOVED******REMOVED******REMOVED***
        assert_equal(r[0:3:2***REMOVED***['f1'***REMOVED***[0***REMOVED***.strides, r[0:3:2***REMOVED***[0***REMOVED***['f1'***REMOVED***.strides***REMOVED***

    def test_alignment_update(self***REMOVED***:
        # Check that alignment flag is updated on stride setting
        a = np.arange(10***REMOVED***
        assert_(a.flags.aligned***REMOVED***
        a.strides = 3
        assert_(not a.flags.aligned***REMOVED***

    def test_ticket_1770(self***REMOVED***:
        "Should not segfault on python 3k"
        import numpy as np
        ***REMOVED***
            a = np.zeros((1,***REMOVED***, dtype=[('f1', 'f'***REMOVED******REMOVED******REMOVED***
            a['f1'***REMOVED*** = 1
            a['f2'***REMOVED*** = 1
        except ValueError:
            pass
        ***REMOVED***
            raise AssertionError

    def test_ticket_1608(self***REMOVED***:
        "x.flat shouldn't modify data"
        x = np.array([[1, 2***REMOVED***, [3, 4***REMOVED******REMOVED******REMOVED***.T
        np.array(x.flat***REMOVED***
        assert_equal(x, [[1, 3***REMOVED***, [2, 4***REMOVED******REMOVED******REMOVED***

    def test_pickle_string_overwrite(self***REMOVED***:
        import re

        data = np.array([1***REMOVED***, dtype='b'***REMOVED***
        blob = pickle.dumps(data, protocol=1***REMOVED***
        data = pickle.loads(blob***REMOVED***

        # Check that loads does not clobber interned strings
        s = re.sub("a(.***REMOVED***", "\x01\\1", "a_"***REMOVED***
        assert_equal(s[0***REMOVED***, "\x01"***REMOVED***
        data[0***REMOVED*** = 0xbb
        s = re.sub("a(.***REMOVED***", "\x01\\1", "a_"***REMOVED***
        assert_equal(s[0***REMOVED***, "\x01"***REMOVED***

    def test_pickle_bytes_overwrite(self***REMOVED***:
        if sys.version_info[0***REMOVED*** >= 3:
            data = np.array([1***REMOVED***, dtype='b'***REMOVED***
            data = pickle.loads(pickle.dumps(data***REMOVED******REMOVED***
            data[0***REMOVED*** = 0xdd
            bytestring = "\x01  ".encode('ascii'***REMOVED***
            assert_equal(bytestring[0:1***REMOVED***, '\x01'.encode('ascii'***REMOVED******REMOVED***

    def test_pickle_py2_array_latin1_hack(self***REMOVED***:
        # Check that unpickling hacks in Py3 that support
        # encoding='latin1' work correctly.

        # Python2 output for pickle.dumps(numpy.array([129***REMOVED***, dtype='b'***REMOVED******REMOVED***
        data = asbytes("cnumpy.core.multiarray\n_reconstruct\np0\n(cnumpy\nndarray\np1\n(I0\n"
                       "tp2\nS'b'\np3\ntp4\nRp5\n(I1\n(I1\ntp6\ncnumpy\ndtype\np7\n(S'i1'\np8\n"
                       "I0\nI1\ntp9\nRp10\n(I3\nS'|'\np11\nNNNI-1\nI-1\nI0\ntp12\nbI00\nS'\\x81'\n"
                       "p13\ntp14\nb."***REMOVED***
        if sys.version_info[0***REMOVED*** >= 3:
            # This should work:
            result = pickle.loads(data, encoding='latin1'***REMOVED***
            assert_array_equal(result, np.array([129***REMOVED***, dtype='b'***REMOVED******REMOVED***
            # Should not segfault:
            assert_raises(Exception, pickle.loads, data, encoding='koi8-r'***REMOVED***

    def test_pickle_py2_scalar_latin1_hack(self***REMOVED***:
        # Check that scalar unpickling hack in Py3 that supports
        # encoding='latin1' work correctly.

        # Python2 output for pickle.dumps(...***REMOVED***
        datas = [
            # (original, python2_pickle, koi8r_validity***REMOVED***
            (np.unicode_('\u6bd2'***REMOVED***,
             asbytes("cnumpy.core.multiarray\nscalar\np0\n(cnumpy\ndtype\np1\n"
                     "(S'U1'\np2\nI0\nI1\ntp3\nRp4\n(I3\nS'<'\np5\nNNNI4\nI4\nI0\n"
                     "tp6\nbS'\\xd2k\\x00\\x00'\np7\ntp8\nRp9\n."***REMOVED***,
             'invalid'***REMOVED***,

            (np.float64(9e123***REMOVED***,
             asbytes("cnumpy.core.multiarray\nscalar\np0\n(cnumpy\ndtype\np1\n(S'f8'\n"
                     "p2\nI0\nI1\ntp3\nRp4\n(I3\nS'<'\np5\nNNNI-1\nI-1\nI0\ntp6\n"
                     "bS'O\\x81\\xb7Z\\xaa:\\xabY'\np7\ntp8\nRp9\n."***REMOVED***,
             'invalid'***REMOVED***,

            (np.bytes_(asbytes('\x9c'***REMOVED******REMOVED***,  # different 8-bit code point in KOI8-R vs latin1
             asbytes("cnumpy.core.multiarray\nscalar\np0\n(cnumpy\ndtype\np1\n(S'S1'\np2\n"
                     "I0\nI1\ntp3\nRp4\n(I3\nS'|'\np5\nNNNI1\nI1\nI0\ntp6\nbS'\\x9c'\np7\n"
                     "tp8\nRp9\n."***REMOVED***,
             'different'***REMOVED***,
        ***REMOVED***
        if sys.version_info[0***REMOVED*** >= 3:
            for original, data, koi8r_validity in datas:
                result = pickle.loads(data, encoding='latin1'***REMOVED***
                assert_equal(result, original***REMOVED***

                # Decoding under non-latin1 encoding (e.g.***REMOVED*** KOI8-R can
                # produce bad results, but should not segfault.
                if koi8r_validity == 'different':
                    # Unicode code points happen to lie within latin1,
                    # but are different in koi8-r, resulting to silent
                    # bogus results
                    result = pickle.loads(data, encoding='koi8-r'***REMOVED***
                    assert_(result != original***REMOVED***
                elif koi8r_validity == 'invalid':
                    # Unicode code points outside latin1, so results
                    # to an encoding exception
                    assert_raises(ValueError, pickle.loads, data, encoding='koi8-r'***REMOVED***
                else:
                    raise ValueError(koi8r_validity***REMOVED***

    def test_structured_type_to_object(self***REMOVED***:
        a_rec = np.array([(0, 1***REMOVED***, (3, 2***REMOVED******REMOVED***, dtype='i4,i8'***REMOVED***
        a_obj = np.empty((2,***REMOVED***, dtype=object***REMOVED***
        a_obj[0***REMOVED*** = (0, 1***REMOVED***
        a_obj[1***REMOVED*** = (3, 2***REMOVED***
        # astype records -> object
        assert_equal(a_rec.astype(object***REMOVED***, a_obj***REMOVED***
        # '=' records -> object
        b = np.empty_like(a_obj***REMOVED***
        b[...***REMOVED*** = a_rec
        assert_equal(b, a_obj***REMOVED***
        # '=' object -> records
        b = np.empty_like(a_rec***REMOVED***
        b[...***REMOVED*** = a_obj
        assert_equal(b, a_rec***REMOVED***

    def test_assign_obj_listoflists(self***REMOVED***:
        # Ticket # 1870
        # The inner list should get assigned to the object elements
        a = np.zeros(4, dtype=object***REMOVED***
        b = a.copy(***REMOVED***
        a[0***REMOVED*** = [1***REMOVED***
        a[1***REMOVED*** = [2***REMOVED***
        a[2***REMOVED*** = [3***REMOVED***
        a[3***REMOVED*** = [4***REMOVED***
        b[...***REMOVED*** = [[1***REMOVED***, [2***REMOVED***, [3***REMOVED***, [4***REMOVED******REMOVED***
        assert_equal(a, b***REMOVED***
        # The first dimension should get broadcast
        a = np.zeros((2, 2***REMOVED***, dtype=object***REMOVED***
        a[...***REMOVED*** = [[1, 2***REMOVED******REMOVED***
        assert_equal(a, [[1, 2***REMOVED***, [1, 2***REMOVED******REMOVED******REMOVED***

    def test_memoryleak(self***REMOVED***:
        # Ticket #1917 - ensure that array data doesn't leak
        for i in range(1000***REMOVED***:
            # 100MB times 1000 would give 100GB of memory usage if it leaks
            a = np.empty((100000000,***REMOVED***, dtype='i1'***REMOVED***
            del a

    def test_ufunc_reduce_memoryleak(self***REMOVED***:
        a = np.arange(6***REMOVED***
        acnt = sys.getrefcount(a***REMOVED***
        np.add.reduce(a***REMOVED***
        assert_equal(sys.getrefcount(a***REMOVED***, acnt***REMOVED***

    def test_search_sorted_invalid_arguments(self***REMOVED***:
        # Ticket #2021, should not segfault.
        x = np.arange(0, 4, dtype='datetime64[D***REMOVED***'***REMOVED***
        assert_raises(TypeError, x.searchsorted, 1***REMOVED***

    def test_string_truncation(self***REMOVED***:
        # Ticket #1990 - Data can be truncated in creation of an array from a
        # mixed sequence of numeric values and strings
        for val in [True, 1234, 123.4, complex(1, 234***REMOVED******REMOVED***:
            for tostr in [asunicode, asbytes***REMOVED***:
                b = np.array([val, tostr('xx'***REMOVED******REMOVED******REMOVED***
                assert_equal(tostr(b[0***REMOVED******REMOVED***, tostr(val***REMOVED******REMOVED***
                b = np.array([tostr('xx'***REMOVED***, val***REMOVED******REMOVED***
                assert_equal(tostr(b[1***REMOVED******REMOVED***, tostr(val***REMOVED******REMOVED***

                # test also with longer strings
                b = np.array([val, tostr('xxxxxxxxxx'***REMOVED******REMOVED******REMOVED***
                assert_equal(tostr(b[0***REMOVED******REMOVED***, tostr(val***REMOVED******REMOVED***
                b = np.array([tostr('xxxxxxxxxx'***REMOVED***, val***REMOVED******REMOVED***
                assert_equal(tostr(b[1***REMOVED******REMOVED***, tostr(val***REMOVED******REMOVED***

    def test_string_truncation_ucs2(self***REMOVED***:
        # Ticket #2081. Python compiled with two byte unicode
        # can lead to truncation if itemsize is not properly
        # adjusted for Numpy's four byte unicode.
        if sys.version_info[0***REMOVED*** >= 3:
            a = np.array(['abcd'***REMOVED******REMOVED***
        else:
            a = np.array([sixu('abcd'***REMOVED******REMOVED******REMOVED***
        assert_equal(a.dtype.itemsize, 16***REMOVED***

    def test_unique_stable(self***REMOVED***:
        # Ticket #2063 must always choose stable sort for argsort to
        # get consistent results
        v = np.array(([0***REMOVED****5 + [1***REMOVED****6 + [2***REMOVED****6***REMOVED****4***REMOVED***
        res = np.unique(v, return_index=True***REMOVED***
        tgt = (np.array([0, 1, 2***REMOVED******REMOVED***, np.array([ 0,  5, 11***REMOVED******REMOVED******REMOVED***
        assert_equal(res, tgt***REMOVED***

    def test_unicode_alloc_dealloc_match(self***REMOVED***:
        # Ticket #1578, the mismatch only showed up when running
        # python-debug for python versions >= 2.7, and then as
        # a core dump and error message.
        a = np.array(['abc'***REMOVED***, dtype=np.unicode***REMOVED***[0***REMOVED***
        del a

    def test_refcount_error_in_clip(self***REMOVED***:
        # Ticket #1588
        a = np.zeros((2,***REMOVED***, dtype='>i2'***REMOVED***.clip(min=0***REMOVED***
        x = a + a
        # This used to segfault:
        y = str(x***REMOVED***
        # Check the final string:
        assert_(y == "[0 0***REMOVED***"***REMOVED***

    def test_searchsorted_wrong_dtype(self***REMOVED***:
        # Ticket #2189, it used to segfault, so we check that it raises the
        # proper exception.
        a = np.array([('a', 1***REMOVED******REMOVED***, dtype='S1, int'***REMOVED***
        assert_raises(TypeError, np.searchsorted, a, 1.2***REMOVED***
        # Ticket #2066, similar problem:
        dtype = np.format_parser(['i4', 'i4'***REMOVED***, [***REMOVED***, [***REMOVED******REMOVED***
        a = np.recarray((2, ***REMOVED***, dtype***REMOVED***
        assert_raises(TypeError, np.searchsorted, a, 1***REMOVED***

    def test_complex64_alignment(self***REMOVED***:
        # Issue gh-2668 (trac 2076***REMOVED***, segfault on sparc due to misalignment
        dtt = np.complex64
        arr = np.arange(10, dtype=dtt***REMOVED***
        # 2D array
        arr2 = np.reshape(arr, (2, 5***REMOVED******REMOVED***
        # Fortran write followed by (C or F***REMOVED*** read caused bus error
        data_str = arr2.tobytes('F'***REMOVED***
        data_back = np.ndarray(arr2.shape,
                              arr2.dtype,
                              buffer=data_str,
                              order='F'***REMOVED***
        assert_array_equal(arr2, data_back***REMOVED***

    def test_structured_count_nonzero(self***REMOVED***:
        arr = np.array([0, 1***REMOVED******REMOVED***.astype('i4, (2***REMOVED***i4'***REMOVED***[:1***REMOVED***
        count = np.count_nonzero(arr***REMOVED***
        assert_equal(count, 0***REMOVED***

    def test_copymodule_preserves_f_contiguity(self***REMOVED***:
        a = np.empty((2, 2***REMOVED***, order='F'***REMOVED***
        b = copy.copy(a***REMOVED***
        c = copy.deepcopy(a***REMOVED***
        assert_(b.flags.fortran***REMOVED***
        assert_(b.flags.f_contiguous***REMOVED***
        assert_(c.flags.fortran***REMOVED***
        assert_(c.flags.f_contiguous***REMOVED***

    def test_fortran_order_buffer(self***REMOVED***:
        import numpy as np
        a = np.array([['Hello', 'Foob'***REMOVED******REMOVED***, dtype='U5', order='F'***REMOVED***
        arr = np.ndarray(shape=[1, 2, 5***REMOVED***, dtype='U1', buffer=a***REMOVED***
        arr2 = np.array([[[sixu('H'***REMOVED***, sixu('e'***REMOVED***, sixu('l'***REMOVED***, sixu('l'***REMOVED***, sixu('o'***REMOVED******REMOVED***,
                          [sixu('F'***REMOVED***, sixu('o'***REMOVED***, sixu('o'***REMOVED***, sixu('b'***REMOVED***, sixu(''***REMOVED******REMOVED******REMOVED******REMOVED******REMOVED***
        assert_array_equal(arr, arr2***REMOVED***

    def test_assign_from_sequence_error(self***REMOVED***:
        # Ticket #4024.
        arr = np.array([1, 2, 3***REMOVED******REMOVED***
        assert_raises(ValueError, arr.__setitem__, slice(None***REMOVED***, [9, 9***REMOVED******REMOVED***
        arr.__setitem__(slice(None***REMOVED***, [9***REMOVED******REMOVED***
        assert_equal(arr, [9, 9, 9***REMOVED******REMOVED***

    def test_format_on_flex_array_element(self***REMOVED***:
        # Ticket #4369.
        dt = np.dtype([('date', '<M8[D***REMOVED***'***REMOVED***, ('val', '<f8'***REMOVED******REMOVED******REMOVED***
        arr = np.array([('2000-01-01', 1***REMOVED******REMOVED***, dt***REMOVED***
        formatted = '{0***REMOVED***'.format(arr[0***REMOVED******REMOVED***
        assert_equal(formatted, str(arr[0***REMOVED******REMOVED******REMOVED***

    def test_deepcopy_on_0d_array(self***REMOVED***:
        # Ticket #3311.
        arr = np.array(3***REMOVED***
        arr_cp = copy.deepcopy(arr***REMOVED***

        assert_equal(arr, arr_cp***REMOVED***
        assert_equal(arr.shape, arr_cp.shape***REMOVED***
        assert_equal(int(arr***REMOVED***, int(arr_cp***REMOVED******REMOVED***
        self.assertTrue(arr is not arr_cp***REMOVED***
        self.assertTrue(isinstance(arr_cp, type(arr***REMOVED******REMOVED******REMOVED***

    def test_bool_subscript_crash(self***REMOVED***:
        # gh-4494
        c = np.rec.array([(1, 2, 3***REMOVED***, (4, 5, 6***REMOVED******REMOVED******REMOVED***
        masked = c[np.array([True, False***REMOVED******REMOVED******REMOVED***
        base = masked.base
        del masked, c
        base.dtype

    def test_richcompare_crash(self***REMOVED***:
        # gh-4613
        import operator as op

        # dummy class where __array__ throws exception
        class Foo(object***REMOVED***:
            __array_priority__ = 1002

            def __array__(self,*args,**kwargs***REMOVED***:
                raise Exception(***REMOVED***

        rhs = Foo(***REMOVED***
        lhs = np.array(1***REMOVED***
        for f in [op.lt, op.le, op.gt, op.ge***REMOVED***:
            if sys.version_info[0***REMOVED*** >= 3:
                assert_raises(TypeError, f, lhs, rhs***REMOVED***
            else:
                f(lhs, rhs***REMOVED***
        assert_(not op.eq(lhs, rhs***REMOVED******REMOVED***
        assert_(op.ne(lhs, rhs***REMOVED******REMOVED***

    def test_richcompare_scalar_and_subclass(self***REMOVED***:
        # gh-4709
        class Foo(np.ndarray***REMOVED***:
            def __eq__(self, other***REMOVED***:
                return "OK"

        x = np.array([1,2,3***REMOVED******REMOVED***.view(Foo***REMOVED***
        assert_equal(10 == x, "OK"***REMOVED***
        assert_equal(np.int32(10***REMOVED*** == x, "OK"***REMOVED***
        assert_equal(np.array([10***REMOVED******REMOVED*** == x, "OK"***REMOVED***

    def test_pickle_empty_string(self***REMOVED***:
        # gh-3926

        import pickle
        test_string = np.string_(''***REMOVED***
        assert_equal(pickle.loads(pickle.dumps(test_string***REMOVED******REMOVED***, test_string***REMOVED***

    def test_frompyfunc_many_args(self***REMOVED***:
        # gh-5672

        def passer(*args***REMOVED***:
            pass

        assert_raises(ValueError, np.frompyfunc, passer, 32, 1***REMOVED***

    def test_repeat_broadcasting(self***REMOVED***:
        # gh-5743
        a = np.arange(60***REMOVED***.reshape(3, 4, 5***REMOVED***
        for axis in chain(range(-a.ndim, a.ndim***REMOVED***, [None***REMOVED******REMOVED***:
            assert_equal(a.repeat(2, axis=axis***REMOVED***, a.repeat([2***REMOVED***, axis=axis***REMOVED******REMOVED***

    def test_frompyfunc_nout_0(self***REMOVED***:
        # gh-2014

        def f(x***REMOVED***:
            x[0***REMOVED***, x[-1***REMOVED*** = x[-1***REMOVED***, x[0***REMOVED***

        uf = np.frompyfunc(f, 1, 0***REMOVED***
        a = np.array([[1, 2, 3***REMOVED***, [4, 5***REMOVED***, [6, 7, 8, 9***REMOVED******REMOVED******REMOVED***
        assert_equal(uf(a***REMOVED***, (***REMOVED******REMOVED***
        assert_array_equal(a, [[3, 2, 1***REMOVED***, [5, 4***REMOVED***, [9, 7, 8, 6***REMOVED******REMOVED******REMOVED***

    def test_leak_in_structured_dtype_comparison(self***REMOVED***:
        # gh-6250
        recordtype = np.dtype([('a', np.float64***REMOVED***,
                               ('b', np.int32***REMOVED***,
                               ('d', (np.str, 5***REMOVED******REMOVED******REMOVED******REMOVED***

        # Simple case
        a = np.zeros(2, dtype=recordtype***REMOVED***
        for i in range(100***REMOVED***:
            a == a
        assert_(sys.getrefcount(a***REMOVED*** < 10***REMOVED***

        # The case in the bug report.
        before = sys.getrefcount(a***REMOVED***
        u, v = a[0***REMOVED***, a[1***REMOVED***
        u == v
        del u, v
        gc.collect(***REMOVED***
        after = sys.getrefcount(a***REMOVED***
        assert_equal(before, after***REMOVED***

    def test_empty_percentile(self***REMOVED***:
        # gh-6530 / gh-6553
        assert_array_equal(np.percentile(np.arange(10***REMOVED***, [***REMOVED******REMOVED***, np.array([***REMOVED******REMOVED******REMOVED***

    def test_void_compare_segfault(self***REMOVED***:
        # gh-6922. The following should not segfault
        a = np.ones(3, dtype=[('object', 'O'***REMOVED***, ('int', '<i2'***REMOVED******REMOVED******REMOVED***
        a.sort(***REMOVED***


if __name__ == "__main__":
    run_module_suite(***REMOVED***
