#ifndef _NPY_INCLUDE_NEIGHBORHOOD_IMP
#error You should not include this header directly
#endif
/*
 * Private API (here for inline***REMOVED***
 */
static NPY_INLINE int
_PyArrayNeighborhoodIter_IncrCoord(PyArrayNeighborhoodIterObject* iter***REMOVED***;

/*
 * Update to next item of the iterator
 *
 * Note: this simply increment the coordinates vector, last dimension
 * incremented first , i.e, for dimension 3
 * ...
 * -1, -1, -1
 * -1, -1,  0
 * -1, -1,  1
 *  ....
 * -1,  0, -1
 * -1,  0,  0
 *  ....
 * 0,  -1, -1
 * 0,  -1,  0
 *  ....
 */
#define _UPDATE_COORD_ITER(c***REMOVED*** \
    wb = iter->coordinates[c***REMOVED*** < iter->bounds[c***REMOVED***[1***REMOVED***; \
    if (wb***REMOVED*** { \
        iter->coordinates[c***REMOVED*** += 1; \
        return 0; \
***REMOVED*** \
    else { \
        iter->coordinates[c***REMOVED*** = iter->bounds[c***REMOVED***[0***REMOVED***; \
***REMOVED***

static NPY_INLINE int
_PyArrayNeighborhoodIter_IncrCoord(PyArrayNeighborhoodIterObject* iter***REMOVED***
{
    npy_intp i, wb;

    for (i = iter->nd - 1; i >= 0; --i***REMOVED*** {
        _UPDATE_COORD_ITER(i***REMOVED***
***REMOVED***

    return 0;
***REMOVED***

/*
 * Version optimized for 2d arrays, manual loop unrolling
 */
static NPY_INLINE int
_PyArrayNeighborhoodIter_IncrCoord2D(PyArrayNeighborhoodIterObject* iter***REMOVED***
{
    npy_intp wb;

    _UPDATE_COORD_ITER(1***REMOVED***
    _UPDATE_COORD_ITER(0***REMOVED***

    return 0;
***REMOVED***
#undef _UPDATE_COORD_ITER

/*
 * Advance to the next neighbour
 */
static NPY_INLINE int
PyArrayNeighborhoodIter_Next(PyArrayNeighborhoodIterObject* iter***REMOVED***
{
    _PyArrayNeighborhoodIter_IncrCoord (iter***REMOVED***;
    iter->dataptr = iter->translate((PyArrayIterObject****REMOVED***iter, iter->coordinates***REMOVED***;

    return 0;
***REMOVED***

/*
 * Reset functions
 */
static NPY_INLINE int
PyArrayNeighborhoodIter_Reset(PyArrayNeighborhoodIterObject* iter***REMOVED***
{
    npy_intp i;

    for (i = 0; i < iter->nd; ++i***REMOVED*** {
        iter->coordinates[i***REMOVED*** = iter->bounds[i***REMOVED***[0***REMOVED***;
***REMOVED***
    iter->dataptr = iter->translate((PyArrayIterObject****REMOVED***iter, iter->coordinates***REMOVED***;

    return 0;
***REMOVED***
