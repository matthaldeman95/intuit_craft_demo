<!-- Within the kernel, we don't know the address of the matplotlib
     websocket server, so we have to get in client-side and fetch our
     resources that way. -->
<script>
  // We can't proceed until these Javascript files are fetched, so
  // we fetch them synchronously
  $.ajaxSetup({async: false***REMOVED******REMOVED***;
  $.getScript("http://" + window.location.hostname + ":{{ port ***REMOVED******REMOVED***{{prefix***REMOVED******REMOVED***/_static/mpl_tornado.js"***REMOVED***;
  $.getScript("http://" + window.location.hostname + ":{{ port ***REMOVED******REMOVED***{{prefix***REMOVED******REMOVED***/mpl.js"***REMOVED***;
  $.ajaxSetup({async: true***REMOVED******REMOVED***;

  function init_figure{{ fig_id ***REMOVED******REMOVED***(e***REMOVED*** {
    $('div.output'***REMOVED***.off('resize'***REMOVED***;

    var output_div = $(e.target***REMOVED***.find('div.output_subarea'***REMOVED***;
    var websocket_type = mpl.get_websocket_type(***REMOVED***;
    var websocket = new websocket_type(
        "ws://" + window.location.hostname + ":{{ port ***REMOVED******REMOVED***{{ prefix***REMOVED******REMOVED***/" +
    ***REMOVED***{ repr(str(fig_id***REMOVED******REMOVED*** ***REMOVED******REMOVED*** + "/ws"***REMOVED***;

    var fig = new mpl.figure(
    ***REMOVED***{repr(str(fig_id***REMOVED******REMOVED******REMOVED******REMOVED***, websocket, mpl_ondownload, output_div***REMOVED***;

    // Fetch the first image
    fig.context.drawImage(fig.imageObj, 0, 0***REMOVED***;

    fig.focus_on_mouseover = true;
  ***REMOVED***

  // We can't initialize the figure contents until our content
  // has been added to the DOM.  This is a bit of hack to get an
  // event for that.
  $('div.output'***REMOVED***.resize(init_figure{{ fig_id ***REMOVED******REMOVED******REMOVED***;
</script>
