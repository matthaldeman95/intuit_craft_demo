#
# A pair of directives for inserting content that will only appear in
# either html or latex.
#

from __future__ import (absolute_import, division, print_function,
                        unicode_literals***REMOVED***

from matplotlib.externals import six

from docutils.nodes import Body, Element
from docutils.parsers.rst import directives

class only_base(Body, Element***REMOVED***:
    def dont_traverse(self, *args, **kwargs***REMOVED***:
        return [***REMOVED***

class html_only(only_base***REMOVED***:
    pass

class latex_only(only_base***REMOVED***:
    pass

def run(content, node_class, state, content_offset***REMOVED***:
    text = '\n'.join(content***REMOVED***
    node = node_class(text***REMOVED***
    state.nested_parse(content, content_offset, node***REMOVED***
    return [node***REMOVED***

def html_only_directive(name, arguments, options, content, lineno,
                        content_offset, block_text, state, state_machine***REMOVED***:
    return run(content, html_only, state, content_offset***REMOVED***

def latex_only_directive(name, arguments, options, content, lineno,
                         content_offset, block_text, state, state_machine***REMOVED***:
    return run(content, latex_only, state, content_offset***REMOVED***

def builder_inited(app***REMOVED***:
    if app.builder.name == 'html':
        latex_only.traverse = only_base.dont_traverse
    else:
        html_only.traverse = only_base.dont_traverse


def setup(app***REMOVED***:
    app.add_directive('htmlonly', html_only_directive, True, (0, 0, 0***REMOVED******REMOVED***
    app.add_directive('latexonly', latex_only_directive, True, (0, 0, 0***REMOVED******REMOVED***

    # This will *really* never see the light of day As it turns out,
    # this results in "broken" image nodes since they never get
    # processed, so best not to do this.
    # app.connect('builder-inited', builder_inited***REMOVED***

    # Add visit/depart methods to HTML-Translator:
    def visit_perform(self, node***REMOVED***:
        pass

    def depart_perform(self, node***REMOVED***:
        pass

    def visit_ignore(self, node***REMOVED***:
        node.children = [***REMOVED***

    def depart_ignore(self, node***REMOVED***:
        node.children = [***REMOVED***

    app.add_node(html_only,
                 html=(visit_perform, depart_perform***REMOVED***,
                 latex=(visit_ignore, depart_ignore***REMOVED******REMOVED***
    app.add_node(latex_only,
                 latex=(visit_perform, depart_perform***REMOVED***,
                 html=(visit_ignore, depart_ignore***REMOVED******REMOVED***
