***REMOVED***
Customized Mixin2to3 support:

 - adds support for converting doctests


This module raises an ImportError on Python 2.
***REMOVED***

from distutils.util import Mixin2to3 as _Mixin2to3
from distutils import log
from lib2to3.refactor import RefactoringTool, get_fixers_from_package

import setuptools


class DistutilsRefactoringTool(RefactoringTool***REMOVED***:
    def log_error(self, msg, *args, **kw***REMOVED***:
        log.error(msg, *args***REMOVED***

    def log_message(self, msg, *args***REMOVED***:
        log.info(msg, *args***REMOVED***

    def log_debug(self, msg, *args***REMOVED***:
        log.debug(msg, *args***REMOVED***


class Mixin2to3(_Mixin2to3***REMOVED***:
    def run_2to3(self, files, doctests=False***REMOVED***:
        # See of the distribution option has been set, otherwise check the
        # setuptools default.
        if self.distribution.use_2to3 is not True:
            return
        if not files:
            return
        log.info("Fixing " + " ".join(files***REMOVED******REMOVED***
        self.__build_fixer_names(***REMOVED***
        self.__exclude_fixers(***REMOVED***
        if doctests:
            if setuptools.run_2to3_on_doctests:
                r = DistutilsRefactoringTool(self.fixer_names***REMOVED***
                r.refactor(files, write=True, doctests_only=True***REMOVED***
        else:
            _Mixin2to3.run_2to3(self, files***REMOVED***

    def __build_fixer_names(self***REMOVED***:
        if self.fixer_names:
            return
        self.fixer_names = [***REMOVED***
        for p in setuptools.lib2to3_fixer_packages:
            self.fixer_names.extend(get_fixers_from_package(p***REMOVED******REMOVED***
        if self.distribution.use_2to3_fixers is not None:
            for p in self.distribution.use_2to3_fixers:
                self.fixer_names.extend(get_fixers_from_package(p***REMOVED******REMOVED***

    def __exclude_fixers(self***REMOVED***:
        excluded_fixers = getattr(self, 'exclude_fixers', [***REMOVED******REMOVED***
        if self.distribution.use_2to3_exclude_fixers is not None:
            excluded_fixers.extend(self.distribution.use_2to3_exclude_fixers***REMOVED***
        for fixer_name in excluded_fixers:
            if fixer_name in self.fixer_names:
                self.fixer_names.remove(fixer_name***REMOVED***
