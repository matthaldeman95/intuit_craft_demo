from distutils import log
import distutils.command.install_scripts as orig
***REMOVED***
import sys

from pkg_resources import Distribution, PathMetadata, ensure_directory


class install_scripts(orig.install_scripts***REMOVED***:
    ***REMOVED***Do normal script install, plus any egg_info wrapper scripts***REMOVED***

    def initialize_options(self***REMOVED***:
        orig.install_scripts.initialize_options(self***REMOVED***
        self.no_ep = False

    def run(self***REMOVED***:
        import setuptools.command.easy_install as ei

        self.run_command("egg_info"***REMOVED***
        if self.distribution.scripts:
            orig.install_scripts.run(self***REMOVED***  # run first to set up self.outfiles
        else:
            self.outfiles = [***REMOVED***
        if self.no_ep:
            # don't install entry point scripts into .egg file!
            return

        ei_cmd = self.get_finalized_command("egg_info"***REMOVED***
        dist = Distribution(
            ei_cmd.egg_base, PathMetadata(ei_cmd.egg_base, ei_cmd.egg_info***REMOVED***,
            ei_cmd.egg_name, ei_cmd.egg_version,
        ***REMOVED***
        bs_cmd = self.get_finalized_command('build_scripts'***REMOVED***
        exec_param = getattr(bs_cmd, 'executable', None***REMOVED***
        bw_cmd = self.get_finalized_command("bdist_wininst"***REMOVED***
        is_wininst = getattr(bw_cmd, '_is_running', False***REMOVED***
        writer = ei.ScriptWriter
        if is_wininst:
            exec_param = "python.exe"
            writer = ei.WindowsScriptWriter
        if exec_param == sys.executable:
            # In case the path to the Python executable contains a space, wrap
            # it so it's not split up.
            exec_param = [exec_param***REMOVED***
        # resolve the writer to the environment
        writer = writer.best(***REMOVED***
        cmd = writer.command_spec_class.best(***REMOVED***.from_param(exec_param***REMOVED***
        for args in writer.get_args(dist, cmd.as_header(***REMOVED******REMOVED***:
            self.write_script(*args***REMOVED***

    def write_script(self, script_name, contents, mode="t", *ignored***REMOVED***:
        ***REMOVED***Write an executable file to the scripts directory***REMOVED***
        from setuptools.command.easy_install import chmod, current_umask

        log.info("Installing %s script to %s", script_name, self.install_dir***REMOVED***
        target = os.path.join(self.install_dir, script_name***REMOVED***
        self.outfiles.append(target***REMOVED***

        mask = current_umask(***REMOVED***
        if not self.dry_run:
            ensure_directory(target***REMOVED***
            f = open(target, "w" + mode***REMOVED***
            f.write(contents***REMOVED***
            f.close(***REMOVED***
            chmod(target, 0o777 - mask***REMOVED***
